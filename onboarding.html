<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="yandex-verification" content="436ec8060c4d8c21" />
    <title>–û–±—É—á–µ–Ω–∏–µ ‚Äî –ß–∞—É–ø–∞—Ä</title>
    <meta name="description" content="–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –∏–≥—Ä–µ –ß–∞—É–ø–∞—Ä. –ò–∑—É—á–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –¥—Ä–µ–≤–Ω–µ–π –∏–Ω–¥–∏–π—Å–∫–æ–π –Ω–∞—Å—Ç–æ–ª—å–Ω–æ–π –∏–≥—Ä—ã." />
    <link type="image/x-icon" href="favicon.ico" rel="shortcut icon">
    <link type="Image/x-icon" href="favicon.ico" rel="icon">
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function(m,e,t,r,i,k,a){
            m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
            m[i].l=1*new Date();
            for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
            k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
        })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=103866554', 'ym');

        ym(103866554, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/103866554" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
	<script src="script.js"></script>
	
	<link rel="stylesheet" href="styles.css">
	<style>
                
    </style>
	
</head>
<body>
    <!-- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –¥–ª—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ -->
    <div id="tutorial-highlight" class="tutorial-highlight" style="display: none;"></div>

    <div class="game-container">
        <nav class="navigation">
            <button class="hamburger" aria-label="–ú–µ–Ω—é">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="page-title-mobile">üë®‚Äçüéì –û–±—É—á–µ–Ω–∏–µ</div>
            <div class="nav-links">
                <a href="onboarding.html" class="current">üë®‚Äçüéì –û–±—É—á–µ–Ω–∏–µ</a>
				<a href="index.html">üéÆ –ò–≥—Ä–∞—Ç—å</a>
                <a href="rules.html">üìã –ü—Ä–∞–≤–∏–ª–∞</a>
                <a href="situations.html">üéØ –ò–≥—Ä–æ–≤—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏</a>
                <a href="news.html">üì∞ –ù–æ–≤–æ—Å—Ç–∏</a>
                <a href="contacts.html">üìß –ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
            </div>
        </nav>

        <h1>–û–±—É—á–µ–Ω–∏–µ –∏–≥—Ä–µ –ß–∞—É–ø–∞—Ä</h1>

        <div class="game-layout">
			<div class="board-with-names">
				<div class="game-board-container">
				
					<div id="game-board" class="game-board"></div>
				</div>

				<div class="dice-panel">
				<!-- 1. –°—á–µ—Ç—á–∏–∫ —à–∞–≥–æ–≤ –∏ –∫–Ω–æ–ø–∫–∞ –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ -->
				<div class="tutorial-controls">
					<div id="tutorial-step-counter" class="tutorial-step-counter">
						<span class="step-number">–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å?</span>
					</div>
					<button id="random-move-btn" disabled>–°–¥–µ–ª–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π —Ö–æ–¥</button>
				</div>

				<!-- 3. –ü–æ–¥—Å–∫–∞–∑–∫–∏ –∏–≥—Ä—ã –∏ –∂—É—Ä–Ω–∞–ª –±—Ä–æ—Å–∫–æ–≤ –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ -->
				<div class="info-section">
					<div class="game-message-container">
						<div class="game-message-title">–ü–æ–¥—Å–∫–∞–∑–∫–∏ –∏ —Å–æ–≤–µ—Ç—ã:</div>
						<div id="game-message" class="game-message">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –æ–±—É—á–µ–Ω–∏–µ! –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –∏–∑—É—á–∏—Ç—å –æ—Å–Ω–æ–≤—ã –∏–≥—Ä—ã.</div>
					</div>
				</div>

				<!-- –°–∫—Ä—ã—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã -->
				<div style="display: none;">
					<div id="current-player" class="current-player">
						–•–æ–¥–∏—Ç: <span id="player-name">–ö—Ä–∞—Å–Ω—ã–π</span>
					</div>
					<button id="roll-dice-btn">–ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫–∏</button>
					<div id="dice-result" class="dice-result"></div>
				</div>
			</div>
        </div>
		</div>
    </div>

    <script>
        // ================================
        // –ö–û–ù–°–¢–ê–ù–¢–´
        // ================================

        const BOARD_CELLS = [
            "G1", "H1", "I1",
            "F2", "G2", "H2", "I2",
            "G3", "H3", "I3",
            "G4", "H4", "I4",
            "F5", "G5", "H5", "I5",
            "G6", "H6", "I6", "K6", "N6",
            "A7", "B7", "C7", "D7", "E7", "F7", "G7", "I7", "J7", "K7", "L7", "M7", "N7", "O7",
            "A8", "B8", "C8", "D8", "E8", "F8", "J8", "K8", "L8", "M8", "N8", "O8",
            "A9", "B9", "C9", "D9", "E9", "F9", "G9", "I9", "J9", "K9", "L9", "M9", "N9", "O9",
            "B10", "E10", "G10", "H10", "I10",
            "G11", "H11", "I11", "J11",
            "G12", "H12", "I12",
            "G13", "H13", "I13",
            "G14", "H14", "I14", "J14",
            "G15", "H15", "I15"
        ];

        const START_ZONES = {
            1: ["M1", "N1", "O1", "M2", "N2", "O2"],
            2: ["A14", "B14", "C14", "A15", "B15", "C15"],
            3: ["N13", "O13", "N14", "O14", "N15", "O15"],
            4: ["A1", "B1", "A2", "B2", "A3", "B3"]
        };

        const WAITING_ZONES = {
            1: ["K1", "K2", "K3", "K4"],
            2: ["E12", "E13", "E14", "E15"],
            3: ["L11", "M11", "N11", "O11"],
            4: ["A5", "B5", "C5", "D5"]
        };

        const ENTRY_CELLS = {
            1: 'I1',
            2: 'G15',
            3: 'O9',
            4: 'A7'
        };

        const TEMPLE_COORDS = ['K6', 'J11', 'E10', 'F5'];
        const JAIL_COORDS = ['N6', 'J14', 'B10', 'F2'];

        const TELEPORT_COORDS = {
            1: 'I7',
            2: 'G9',
            3: 'I9',
            4: 'G7'
        };

        const TELEPORT_MAPPINGS = {
            'I7': {
                1: 'I9',
                3: 'G9',
                6: 'G7'
            },
            'G9': {
                1: 'G7',
                3: 'I7',
                6: 'I9'
            },
            'I9': {
                1: 'G9',
                3: 'G7',
                6: 'I7'
            },
            'G7': {
                1: 'I7',
                3: 'I9',
                6: 'G9'
            }
        };

        const DICE_AREAS = {
            1: { from: 'M4', to: 'O5' },
            2: { from: 'A12', to: 'C13' },
            3: { from: 'K14', to: 'M15' },
            4: { from: 'C2', to: 'E3' }
        };

        const PLAYER_PATHS = {
            1: [
                'I1', 'I2', 'I3', 'I4', 'I5', 'I6', 'I7',
                'J7', 'K7', 'L7', 'M7', 'N7', 'O7',
                'O8', 'O9',
                'N9', 'M9', 'L9', 'K9', 'J9', 'I9',
                'I10', 'I11', 'I12', 'I13', 'I14', 'I15',
                'H15', 'G15',
                'G14', 'G13', 'G12', 'G11', 'G10', 'G9',
                'F9', 'E9', 'D9', 'C9', 'B9', 'A9',
                'A8', 'A7',
                'B7', 'C7', 'D7', 'E7', 'F7', 'G7',
                'G6', 'G5', 'G4', 'G3', 'G2', 'G1',
                'H1',
                'H2', 'H3', 'H4', 'H5', 'H6'
            ],
            2: [
                'G15', 'G14', 'G13', 'G12', 'G11', 'G10', 'G9',
                'F9', 'E9', 'D9', 'C9', 'B9', 'A9',
                'A8', 'A7',
                'B7', 'C7', 'D7', 'E7', 'F7', 'G7',
                'G6', 'G5', 'G4', 'G3', 'G2', 'G1',
                'H1', 'I1',
                'I2', 'I3', 'I4', 'I5', 'I6', 'I7',
                'J7', 'K7', 'L7', 'M7', 'N7', 'O7',
                'O8', 'O9',
                'N9', 'M9', 'L9', 'K9', 'J9', 'I9',
                'I10', 'I11', 'I12', 'I13', 'I14', 'I15',
                'H15',
                'H14', 'H13', 'H12', 'H11', 'H10'
            ],
            3: [
                'O9', 'N9', 'M9', 'L9', 'K9', 'J9', 'I9',
                'I10', 'I11', 'I12', 'I13', 'I14', 'I15',
                'H15', 'G15',
                'G14', 'G13', 'G12', 'G11', 'G10', 'G9',
                'F9', 'E9', 'D9', 'C9', 'B9', 'A9',
                'A8', 'A7',
                'B7', 'C7', 'D7', 'E7', 'F7', 'G7',
                'G6', 'G5', 'G4', 'G3', 'G2', 'G1',
                'H1', 'I1',
                'I2', 'I3', 'I4', 'I5', 'I6', 'I7',
                'J7', 'K7', 'L7', 'M7', 'N7', 'O7',
                'O8',
                'N8', 'M8', 'L8', 'K8', 'J8'
            ],
            4: [
                'A7', 'B7', 'C7', 'D7', 'E7', 'F7', 'G7',
                'G6', 'G5', 'G4', 'G3', 'G2', 'G1',
                'H1', 'I1',
                'I2', 'I3', 'I4', 'I5', 'I6', 'I7',
                'J7', 'K7', 'L7', 'M7', 'N7', 'O7',
                'O8', 'O9',
                'N9', 'M9', 'L9', 'K9', 'J9', 'I9',
                'I10', 'I11', 'I12', 'I13', 'I14', 'I15',
                'H15', 'G15',
                'G14', 'G13', 'G12', 'G11', 'G10', 'G9',
                'F9', 'E9', 'D9', 'C9', 'B9', 'A9',
                'A8',
                'B8', 'C8', 'D8', 'E8', 'F8'
            ]
        };

        const SPECIAL_MOVES = {
            'K7': 'K6',
            'N7': 'N6',
            'I11': 'J11',
            'I14': 'J14',
            'E9': 'E10',
            'B9': 'B10',
            'G5': 'F5',
            'G2': 'F2'
        };

        // ================================
        // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        // ================================

        let gameBoard = {};
        let playerCount = 2;
        let pieces = {};
        let playerNames = {1: '–ö—Ä–∞—Å–Ω—ã–π', 2: '–ñ–µ–ª—Ç—ã–π', 3: '–ó–µ–ª–µ–Ω—ã–π', 4: '–§–∏–æ–ª–µ—Ç–æ–≤—ã–π'};
        let currentPlayer = 1;
        let gamePhase = 'playing';
        let lastDiceRoll = [0, 0];
        let diceUsed = [false, false];
        let playerDiceValues = {1: [1, 6], 2: [2, 5], 3: [3, 4], 4: [2, 5]};
        let playerColors = ['–ö—Ä–∞—Å–Ω—ã–π', '–ñ–µ–ª—Ç—ã–π', '–ó–µ–ª–µ–Ω—ã–π', '–§–∏–æ–ª–µ—Ç–æ–≤—ã–π'];
        let diceRollNumber = 0;
        let selectedPiece = null;
        let cachedValidMoves = [];
        let gameMessages = [];
        let currentHighlightSelector = null;  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π —Å–µ–ª–µ–∫—Ç–æ—Ä –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
        let currentHighlightType = 'element';  // 'element' –∏–ª–∏ 'zone'
        let currentTooltip = null;

        // ================================
        // –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –ö–û–ù–°–¢–ê–ù–¢–´ –û–ù–ë–û–†–î–ò–ù–ì–ê
        // ================================

        let isTutorialActive = true;

        // –ú–∞—Å—Å–∏–≤ TUTORIAL_STEPS —É–¥–∞–ª–µ–Ω - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω—ã–π –ø–æ–¥—Ö–æ–¥
        // –°–º. —Ñ—É–Ω–∫—Ü–∏—é runTutorial() –Ω–∏–∂–µ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è –æ–±—É—á–µ–Ω–∏—è

        // ================================
        // –§–£–ù–ö–¶–ò–ò –ö–û–û–†–î–ò–ù–ê–¢ –ò –ü–û–ó–ò–¶–ò–û–ù–ò–†–û–í–ê–ù–ò–Ø
        // ================================

        

        

        function getCurrentPosition(piece) {
            const rect = piece.getBoundingClientRect();
            const boardRect = document.getElementById('game-board').getBoundingClientRect();

            // –í—ã—á–∏—Å–ª—è–µ–º –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —ç–∫—Ä–∞–Ω–∞
            let cellSize;
            if (window.innerWidth <= 768) {
                cellSize = window.innerWidth / 15;
            } else {
                const boardSize = Math.min(window.innerWidth * 0.9, 600);
                cellSize = boardSize * 35 / 600;
            }

            // –°–º–µ—â–µ–Ω–∏–µ = –ø–æ–ª–æ–≤–∏–Ω–∞ –∫–ª–µ—Ç–∫–∏ –¥–ª—è –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ —Ü–µ–Ω—Ç—Ä
            const offset = cellSize / 2;

            const x = rect.left - boardRect.left + offset;
            const y = rect.top - boardRect.top + offset;
            return positionToCoord(x, y);
        }


        // ================================
        // –§–£–ù–ö–¶–ò–ò –†–ï–ù–î–ï–†–ò–ù–ì–ê
        // ================================

        function createBoard() {
            const board = document.getElementById('game-board');
            if (!board) {
                return;
            }

            board.innerHTML = '';

            BOARD_CELLS.forEach((coord) => {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.coord = coord;

                const pos = coordToPosition(coord);
                cell.style.left = pos.x + 'px';
                cell.style.top = pos.y + 'px';

                board.appendChild(cell);
                gameBoard[coord] = null;
            });

            for (let player = 1; player <= 4; player++) {
                START_ZONES[player].forEach(coord => {
                    const cell = document.createElement('div');
                    cell.className = 'cell start-zone';
                    cell.dataset.coord = coord;
                    cell.dataset.player = player;

                    const pos = coordToPosition(coord);
                    cell.style.left = pos.x + 'px';
                    cell.style.top = pos.y + 'px';

                    board.appendChild(cell);
                    gameBoard[coord] = [];
                });
            }

            for (let player = 1; player <= 4; player++) {
                WAITING_ZONES[player].forEach(coord => {
                    const cell = document.createElement('div');
                    cell.className = 'cell waiting-zone';
                    cell.dataset.coord = coord;
                    cell.dataset.player = player;

                    const pos = coordToPosition(coord);
                    cell.style.left = pos.x + 'px';
                    cell.style.top = pos.y + 'px';

                    board.appendChild(cell);
                    gameBoard[coord] = [];
                });
            }

            createDirectionArrows();
            createTemplesAndJails();
            createTeleportIcons();
            createHomeIcons();
        }

        

        function createPieces() {
            const board = document.getElementById('game-board');
            const colors = ['player1', 'player2', 'player3', 'player4'];
            pieces = {};

            for (let player = 1; player <= playerCount; player++) {
                pieces[player] = [];
                const startCoords = START_ZONES[player];

                startCoords.forEach((coord, index) => {
                    const piece = document.createElement('div');
                    piece.className = `piece ${colors[player-1]}`;
                    piece.dataset.player = player;
                    piece.dataset.id = `p${player}_${index}`;

                    const pos = coordToPosition(coord);
                    piece.style.left = pos.x + 'px';
                    piece.style.top = pos.y + 'px';
                    piece.style.zIndex = '10';
                    piece.style.position = 'absolute';

                    board.appendChild(piece);
                    pieces[player].push(piece);

                    if (!gameBoard[coord]) {
                        gameBoard[coord] = [];
                    }
                    gameBoard[coord].push(piece);
                });
            }
        }

        // ================================
        // –§–£–ù–ö–¶–ò–ò –ü–û–î–°–ö–ê–ó–û–ö
        // ================================

        

        function showSingleMoveHint(move) {
			console.log ('–ú—ã –≤ showSingleMoveHint');
            const cell = document.querySelector(`[data-coord="${move.coord}"]`);
            if (cell) {
				//console.log ('cell:' + cell);
                const hint = document.createElement('div');
                hint.className = move.isTeleport ? 'move-hint teleport-hint' : 'move-hint';

                hint.textContent = move.isTeleport ? `–¢${move.steps}` : move.steps;

                cell.appendChild(hint);
                cell.classList.add('possible-move');
            }
        }



        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤ —Ñ–∏—à–∫–∏
        function calculatePossibleMoves(piece, steps = 12, dice1 = 0, dice2 = 0) {
            const playerNum = parseInt(piece.dataset.player);
            const position = getPiecePosition(piece);
			console.log ('position.type = ' + position.type);
            const path = PLAYER_PATHS[playerNum];
            const possibleMoves = [];

            if (position.type === 'start') {
                // –§–∏—à–∫–∞ –≤ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –∑–æ–Ω–µ - –Ω—É–∂–Ω–∞ 1 –¥–ª—è –≤—ã—Ö–æ–¥–∞
				console.log ('position.type tart');
                const waitingZones = WAITING_ZONES[playerNum];
                const hasOne = (dice1 === 1) || (dice2 === 1);

                if (hasOne) {
                    // –ü—Ä–æ—Å—Ç—ã–µ —Ö–æ–¥—ã –Ω–∞ 1 –≤–æ –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ WAITING_ZONES
                    waitingZones.forEach(coord => {
                        possibleMoves.push({
                            coord: coord,
                            steps: 1
                        });
                    });

                    // –ö–æ–º–±–æ-—Ö–æ–¥—ã: –µ—Å–ª–∏ –µ—Å—Ç—å –µ–¥–∏–Ω–∏—Ü–∞, –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ç–æ—Ä–æ–π –∫—É–±–∏–∫ –¥–ª—è –¥–≤–∏–∂–µ–Ω–∏—è
                    const otherDiceValues = [];
                    if (dice1 === 1 && dice2 >= 1) otherDiceValues.push(dice2);
                    if (dice2 === 1 && dice1 >= 1 && dice1 !== dice2) otherDiceValues.push(dice1);

                    otherDiceValues.forEach(diceValue => {
                        const entryCell = ENTRY_CELLS[playerNum];
                        const entryIndex = path.indexOf(entryCell);

                        if (entryIndex >= 0) {
                            if (diceValue === 1) {
                                // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–ª—É—á–∞–π –¥–ª—è 1:1 - –≤—ã—Ö–æ–¥ –ø—Ä—è–º–æ –Ω–∞ –≤—Ö–æ–¥–Ω—É—é –∫–ª–µ—Ç–∫—É
                                possibleMoves.push({
                                    coord: entryCell,
                                    steps: 2
                                });
                            } else {
                                // –û–±—ã—á–Ω—ã–π —Å–ª—É—á–∞–π: 1 –¥–ª—è –≤—ã—Ö–æ–¥–∞ + –æ—Å—Ç–∞—Ç–æ–∫ –¥–ª—è –¥–≤–∏–∂–µ–Ω–∏—è
                                const remainingSteps = diceValue - 1;
                                if (remainingSteps > 0) {
                                    const targetIndex = entryIndex + remainingSteps;
                                    if (targetIndex < path.length) {
                                        possibleMoves.push({
                                            coord: path[targetIndex],
                                            steps: 1 + diceValue
                                        });
                                    }
                                }
                            }
                        }
                    });
                }
            } else if (position.type === 'waiting') {
                // –§–∏—à–∫–∞ –≤ –∑–æ–Ω–µ –æ–∂–∏–¥–∞–Ω–∏—è - –º–æ–∂–µ—Ç –≤—ã–π—Ç–∏ –Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ –ø–æ–ª–µ
                const entryCell = ENTRY_CELLS[playerNum];
                const entryIndex = path.indexOf(entryCell);

                for (let i = 1; i <= Math.min(steps, 12); i++) {
                    const targetIndex = entryIndex + i - 1;
                    if (targetIndex >= 0 && targetIndex < path.length) {
                        possibleMoves.push({
                            coord: path[targetIndex],
                            steps: i
                        });
                    }
                }
            } else if (position.type === 'board') {
                // –§–∏—à–∫–∞ —É–∂–µ –Ω–∞ –ø–æ–ª–µ
                const currentIndex = path.indexOf(position.coord);
                if (currentIndex >= 0) {
                    for (let i = 1; i <= Math.min(steps, 12); i++) {
                        const targetIndex = currentIndex + i;
                        if (targetIndex < path.length) {
                            possibleMoves.push({
                                coord: path[targetIndex],
                                steps: i
                            });
                        }
                    }
                }
            }
			else {console.log ('—è–Ω–∏—à–º–∞–≥–ª—è');}

            return possibleMoves;
        }

        function calculateAndCacheValidMoves(piece) {
            // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∫—É–±–∏–∫–æ–≤ —Å —É—á–µ—Ç–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö
            
			const dice1 = diceUsed[0] ? 0 : lastDiceRoll[0];
            const dice2 = diceUsed[1] ? 0 : lastDiceRoll[1];
			console.log ('dice1 = ' + dice1 + 'dice2 = ' + dice2);

            if (dice1 === 0 && dice2 === 0) {
                return [];
            }

            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ö–æ–¥—ã –¥–ª—è —Ñ–∏—à–∫–∏ —Å —É—á–µ—Ç–æ–º –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ù–´–• –∫—É–±–∏–∫–æ–≤
            // –ü–µ—Ä–µ–¥–∞–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —á—Ç–æ–±—ã calculatePossibleMoves –ø—Ä–∞–≤–∏–ª—å–Ω–æ
            // –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –∑–æ–Ω—ã (–Ω—É–∂–Ω–∞ –µ–¥–∏–Ω–∏—Ü–∞!)
            const allPossibleMoves = calculatePossibleMoves(piece, 12, dice1, dice2);
			console.log ('allPossibleMoves = ' + allPossibleMoves);

            // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –∫—É–±–∏–∫–æ–≤
            const availableMoves = new Set();

            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∫—É–±–∏–∫–∏
            if (!diceUsed[0] && dice1 > 0) availableMoves.add(dice1);
            if (!diceUsed[1] && dice2 > 0) availableMoves.add(dice2);

            // –°—É–º–º–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–±–∞ –∫—É–±–∏–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã
            if (!diceUsed[0] && !diceUsed[1] && dice1 > 0 && dice2 > 0) {
                availableMoves.add(dice1 + dice2);
            }

            const filteredMoves = allPossibleMoves.filter(move =>
                availableMoves.has(move.steps)
            );

            return filteredMoves;
        }


        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ñ–∏—à–∫–∏ —Å –ø–æ–∫–∞–∑–æ–º –ø–æ–¥—Å–∫–∞–∑–æ–∫
        function updateSelectedPiece(piece) {
            selectPiece(piece);

            if (piece) {                
                // –í—ã—á–∏—Å–ª—è–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ö–æ–¥—ã
                const validMoves = calculateAndCacheValidMoves(piece);
                console.log ('–ú—ã –≤—ã—á–∏—Å–ª—è–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ö–æ–¥—ã –¥–ª—è' + piece.dataset.id + ' –∞ validMoves = ' + validMoves);
				clearMoveHints();
				console.log ('–ú—ã –ø—Ä–æ—à–ª–∏ clearMoveHints');
                validMoves.forEach(move => {                    
					showSingleMoveHint(move);
                });
            } else {
                // –û—á–∏—â–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ —Å–Ω—è—Ç–∏–∏ –≤—ã–¥–µ–ª–µ–Ω–∏—è
                clearMoveHints();
            }
        }

        // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —Ñ–∏—à–∫–∏ –¥–ª—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
        function performMove(piece, targetCoord, skipValidation = false) {
            if (!piece || !targetCoord) return;

            const currentPos = getCurrentPosition(piece);

            let stepsUsed = 0;

            if (!skipValidation) {
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤
                const validMoves = calculateAndCacheValidMoves(piece);

                const targetMove = validMoves.find(move => move.coord === targetCoord);

                if (!targetMove) {                    
                    return;
                }                

                stepsUsed = targetMove.steps;
            } 
            const dice1 = lastDiceRoll[0];
            const dice2 = lastDiceRoll[1];

            // –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ñ–∏—à–∫—É
            movePiece(piece, targetCoord);

            // –û—Ç–º–µ—á–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∫—É–±–∏–∫–∏
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫–æ–π –∫—É–±–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ö–æ–¥–∞
            if (stepsUsed === dice1 + dice2 && !diceUsed[0] && !diceUsed[1]) {
                // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –æ–±–∞ –∫—É–±–∏–∫–∞
                diceUsed[0] = true;
                diceUsed[1] = true;
                
            } else if (stepsUsed === dice1 && !diceUsed[0]) {
                // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø–µ—Ä–≤—ã–π –∫—É–±–∏–∫
                diceUsed[0] = true;                
            } else if (stepsUsed === dice2 && !diceUsed[1]) {
                // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤—Ç–æ—Ä–æ–π –∫—É–±–∏–∫
                diceUsed[1] = true;
            } else if (stepsUsed === dice1 && !diceUsed[1] && dice1 === dice2) {
                // –î–ª—è –¥—É–±–ª–µ–π: –µ—Å–ª–∏ –ø–µ—Ä–≤—ã–π —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Ç–æ—Ä–æ–π
                diceUsed[1] = true;
            }

            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Ö–æ–¥–∞ (–∫–∞–∫ –≤ index.html)
            // –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–≥—Ä–æ–∫—É –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é —Ñ–∏—à–∫—É –∏–ª–∏ —Ç—É –∂–µ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ö–æ–¥–∞
            updateSelectedPiece(null);

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ currentTutorialStep —É–¥–∞–ª–µ–Ω–∞ - –ª–æ–≥–∏–∫–∞ —Ç–µ–ø–µ—Ä—å –≤ runTutorial()
        }

        // –§—É–Ω–∫—Ü–∏—è startYellowPlayerTurn —É–¥–∞–ª–µ–Ω–∞ - –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ runTutorial()

        // ================================
        // –§–£–ù–ö–¶–ò–ò –°–û–û–ë–©–ï–ù–ò–ô
        // ================================

        function updateGameMessage(message) {
            gameMessages.push(message);

            if (gameMessages.length > 7) {
                gameMessages = gameMessages.slice(-7);
            }

            const messageElement = document.getElementById('game-message');
            if (!messageElement) return;

            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            messageElement.innerHTML = '';

            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            const reversedMessages = [...gameMessages].reverse();
            reversedMessages.forEach((msg, index) => {
                // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message-item';
                messageDiv.innerHTML = msg;

                // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –∫ —Å–∞–º–æ–º—É –Ω–æ–≤–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
                if (index === 0) {
                    messageDiv.classList.add('message-new');
                    // –£–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
                    setTimeout(() => {
                        messageDiv.classList.remove('message-new');
                    }, 3000);
                }

                messageElement.appendChild(messageDiv);

                // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å (–∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞)
                if (index < reversedMessages.length - 1) {
                    const divider = document.createElement('div');
                    divider.className = 'message-divider';
                    divider.textContent = '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ';
                    messageElement.appendChild(divider);
                }
            });
        }


        // ================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // ================================

        window.addEventListener('DOMContentLoaded', () => {
            createBoard();
            createPieces();
            createPlayerDice();
            updatePlayerDiceStates();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
            initTutorial();

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∏
            let ticking = false;
            window.addEventListener('scroll', () => {
                if (!ticking) {
                    window.requestAnimationFrame(() => {
                        updateHighlightPosition();
                        ticking = false;
                    });
                    ticking = true;
                }
            }, { passive: true });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            let resizeTicking = false;
            window.addEventListener('resize', () => {
                if (!resizeTicking) {
                    window.requestAnimationFrame(() => {
                        updateHighlightPosition();
                        resizeTicking = false;
                    });
                    resizeTicking = true;
                }
            }, { passive: true });
        });

        // ================================
        // –§–£–ù–ö–¶–ò–ò –ü–û–î–°–í–ï–¢–ö–ò –î–õ–Ø –û–ù–ë–û–†–î–ò–ù–ì–ê
        // ================================

        // –ü–æ–¥—Å–≤–µ—Ç–∏—Ç—å –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç –∏–ª–∏ –∑–æ–Ω—É —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        function highlightElement(selector) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
            currentHighlightSelector = selector;
            currentHighlightType = 'element';

            const highlight = document.getElementById('tutorial-highlight');
            const elements = document.querySelectorAll(selector);

            if (elements.length === 0) {
                highlight.style.display = 'none';
                return;
            }

            // –î–ª—è –æ–¥–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ - –æ–±—ã—á–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞
            if (elements.length === 1) {
                const element = elements[0];
                const rect = element.getBoundingClientRect();
                highlight.style.display = 'block';
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º pageX/pageY –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (absolute positioning)
                highlight.style.left = (rect.left + window.scrollX - 10) + 'px';
                highlight.style.top = (rect.top + window.scrollY - 10) + 'px';
                highlight.style.width = (rect.width + 20) + 'px';
                highlight.style.height = (rect.height + 20) + 'px';
            } else {
                // –î–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ - –æ–±—ä–µ–¥–∏–Ω—è—é—â–∞—è –∑–æ–Ω–∞
                highlightZone(selector);
            }
        }

        // –ü–æ–¥—Å–≤–µ—Ç–∏—Ç—å –∑–æ–Ω—É, –æ—Ö–≤–∞—Ç—ã–≤–∞—é—â—É—é –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        // –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –∏–ª–∏ –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫
        function highlightZone(selector) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
            currentHighlightSelector = selector;
            currentHighlightType = 'zone';

            const highlight = document.getElementById('tutorial-highlight');

            // –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –º–∞—Å—Å–∏–≤ - —Å–æ–∑–¥–∞—Ç—å —Ä–∞–º–∫—É –¥–ª—è –∫–∞–∂–¥–æ–π –∑–æ–Ω—ã
            if (Array.isArray(selector)) {
                highlight.style.display = 'none';

                // –¶–∏–∫–ª –ø–æ –∫–∞–∂–¥–æ–π –∑–æ–Ω–µ
                selector.forEach(zoneSelector => {
                    const elements = document.querySelectorAll(zoneSelector);
                    if (elements.length === 0) return;

                    // –í—ã—á–∏—Å–ª–∏—Ç—å –æ—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –¥–ª—è —ç—Ç–æ–π –∑–æ–Ω—ã
                    let minLeft = Infinity;
                    let minTop = Infinity;
                    let maxRight = -Infinity;
                    let maxBottom = -Infinity;

                    elements.forEach(element => {
                        const rect = element.getBoundingClientRect();
                        minLeft = Math.min(minLeft, rect.left);
                        minTop = Math.min(minTop, rect.top);
                        maxRight = Math.max(maxRight, rect.right);
                        maxBottom = Math.max(maxBottom, rect.bottom);
                    });

                    // –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —Ä–∞–º–∫—É –¥–ª—è —ç—Ç–æ–π –∑–æ–Ω—ã —Å pageX/pageY –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
                    createHighlightElement({
                        left: minLeft + window.scrollX,
                        top: minTop + window.scrollY,
                        width: maxRight - minLeft,
                        height: maxBottom - minTop
                    });
                });
                return;
            }

            // –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω–∞ —Å—Ç—Ä–æ–∫–∞ - –æ–¥–Ω–∞ —Ä–∞–º–∫–∞ –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            const elements = document.querySelectorAll(selector);

            if (elements.length === 0) {
                highlight.style.display = 'none';
                return;
            }

            // –í—ã—á–∏—Å–ª–∏—Ç—å –æ—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            let minLeft = Infinity;
            let minTop = Infinity;
            let maxRight = -Infinity;
            let maxBottom = -Infinity;

            elements.forEach(element => {
                const rect = element.getBoundingClientRect();
                minLeft = Math.min(minLeft, rect.left);
                minTop = Math.min(minTop, rect.top);
                maxRight = Math.max(maxRight, rect.right);
                maxBottom = Math.max(maxBottom, rect.bottom);
            });

            // –ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ–±—ä–µ–¥–∏–Ω—è—é—â—É—é —Ä–∞–º–∫—É —Å pageX/pageY –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
            highlight.style.display = 'block';
            highlight.style.left = (minLeft + window.scrollX - 10) + 'px';
            highlight.style.top = (minTop + window.scrollY - 10) + 'px';
            highlight.style.width = (maxRight - minLeft + 20) + 'px';
            highlight.style.height = (maxBottom - minTop + 20) + 'px';
        }
		

        // –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
        function updateHighlightPosition() {
            if (!currentHighlightSelector) return;

            const highlight = document.getElementById('tutorial-highlight');
            if (!highlight || highlight.style.display === 'none') return;

            // –ù–∞–ø—Ä—è–º—É—é –æ–±–Ω–æ–≤–ª—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –±–µ–∑ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            if (Array.isArray(currentHighlightSelector)) {
                // –î–ª—è –º–∞—Å—Å–∏–≤–∞ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ - –æ–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–¥—Å–≤–µ—Ç–∫–∏
                const multiHighlights = document.querySelectorAll('.tutorial-highlight-multi');
                let index = 0;
                currentHighlightSelector.forEach(zoneSelector => {
                    const elements = document.querySelectorAll(zoneSelector);
                    if (elements.length === 0) return;

                    let minLeft = Infinity, minTop = Infinity;
                    let maxRight = -Infinity, maxBottom = -Infinity;

                    elements.forEach(element => {
                        const rect = element.getBoundingClientRect();
                        minLeft = Math.min(minLeft, rect.left);
                        minTop = Math.min(minTop, rect.top);
                        maxRight = Math.max(maxRight, rect.right);
                        maxBottom = Math.max(maxBottom, rect.bottom);
                    });

                    if (multiHighlights[index]) {
                        multiHighlights[index].style.left = (minLeft + window.scrollX - 10) + 'px';
                        multiHighlights[index].style.top = (minTop + window.scrollY - 10) + 'px';
                        multiHighlights[index].style.width = (maxRight - minLeft + 20) + 'px';
                        multiHighlights[index].style.height = (maxBottom - minTop + 20) + 'px';
                    }
                    index++;
                });
            } else {
                // –î–ª—è –æ–¥–Ω–æ–≥–æ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞
                const elements = document.querySelectorAll(currentHighlightSelector);
                if (elements.length === 0) return;

                if (elements.length === 1) {
                    // –û–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç - –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å pageX/pageY –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
                    const rect = elements[0].getBoundingClientRect();
                    highlight.style.left = (rect.left + window.scrollX - 10) + 'px';
                    highlight.style.top = (rect.top + window.scrollY - 10) + 'px';
                    highlight.style.width = (rect.width + 20) + 'px';
                    highlight.style.height = (rect.height + 20) + 'px';
                } else {
                    // –ù–µ—Å–∫–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ - –≤—ã—á–∏—Å–ª—è–µ–º –æ–±—ä–µ–¥–∏–Ω—è—é—â–∏–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫
                    let minLeft = Infinity, minTop = Infinity;
                    let maxRight = -Infinity, maxBottom = -Infinity;

                    elements.forEach(element => {
                        const rect = element.getBoundingClientRect();
                        minLeft = Math.min(minLeft, rect.left);
                        minTop = Math.min(minTop, rect.top);
                        maxRight = Math.max(maxRight, rect.right);
                        maxBottom = Math.max(maxBottom, rect.bottom);
                    });

                    highlight.style.left = (minLeft + window.scrollX - 10) + 'px';
                    highlight.style.top = (minTop + window.scrollY - 10) + 'px';
                    highlight.style.width = (maxRight - minLeft + 20) + 'px';
                    highlight.style.height = (maxBottom - minTop + 20) + 'px';
                }
            }
        }

        // –°–∫—Ä—ã—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫—É
        function clearHighlight() {
            const highlight = document.getElementById('tutorial-highlight');
            highlight.style.display = 'none';

            // –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–¥—Å–≤–µ—Ç–∫–∏
            const multiHighlights = document.querySelectorAll('.tutorial-highlight-multi');
            multiHighlights.forEach(h => h.remove());

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä
            currentHighlightSelector = null;
            currentHighlightType = 'element';
        }

        // ================================
        // –§–£–ù–ö–¶–ò–ò –†–ê–ë–û–¢–´ –° –§–ò–®–ö–ê–ú–ò
        // ================================

        // –£–¥–∞–ª–∏—Ç—å —Ñ–∏—à–∫—É –∏–∑ –∫–ª–µ—Ç–∫–∏ –≤ gameBoard
        function removePieceFromCell(piece, coord) {
            if (gameBoard[coord]) {
                if (Array.isArray(gameBoard[coord])) {
                    const index = gameBoard[coord].indexOf(piece);
                    if (index > -1) {
                        gameBoard[coord].splice(index, 1);
                    }
                } else if (gameBoard[coord] === piece) {
                    gameBoard[coord] = null;
                }
            }
        }

        // –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏—à–∫—É –≤ –∫–ª–µ—Ç–∫—É gameBoard
        function addPieceToCell(piece, coord) {
            const isWaitingZone = Object.values(WAITING_ZONES).flat().includes(coord);
            const isStartZone = Object.values(START_ZONES).flat().includes(coord);

            if (isWaitingZone || isStartZone) {
                if (!gameBoard[coord]) {
                    gameBoard[coord] = [];
                }
                gameBoard[coord].push(piece);
            } else {
                gameBoard[coord] = piece;
            }
        }

        // –í—ã—á–∏—Å–ª–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é —Ñ–∏—à–∫–∏ —Å —É—á–µ—Ç–æ–º –æ—Ñ—Å–µ—Ç–æ–≤ –¥–ª—è –∑–æ–Ω
        function calculatePiecePosition(coord) {
            const basePos = coordToPosition(coord);
            const isWaitingZone = Object.values(WAITING_ZONES).flat().includes(coord);
            const isStartZone = Object.values(START_ZONES).flat().includes(coord);

            if (isWaitingZone || isStartZone) {
                const piecesInCell = gameBoard[coord] ? gameBoard[coord].length : 0;
                const offset = piecesInCell * 3;
                return {
                    x: basePos.x + offset,
                    y: basePos.y + offset
                };
            }

            return basePos;
        }

        // –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ñ–∏—à–∫—É –Ω–∞ –Ω–æ–≤—É—é –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É
        function movePiece(piece, targetCoord) {
            const currentPos = getCurrentPosition(piece);
            if (currentPos) {
                removePieceFromCell(piece, currentPos);
            }

            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏—à–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∑–æ–Ω—ã
            const pos = calculatePiecePosition(targetCoord);
            piece.style.left = pos.x + 'px';
            piece.style.top = pos.y + 'px';

            addPieceToCell(piece, targetCoord);

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –≤ –º–∞—Å—Å–∏–≤–µ pieces
            const piecePlayer = parseInt(piece.dataset.player);
            if (pieces[piecePlayer]) {
                const pieceData = pieces[piecePlayer].find(p => p.element === piece);
                if (pieceData) {
                    pieceData.position = targetCoord;
                }
            }
        }

        // –ê–Ω–∏–º–∏—Ä–æ–≤–∞—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ —Ñ–∏—à–∫–∏ –≤–¥–æ–ª—å –ø—É—Ç–∏
        function animatePieceAlongPath(piece, path, delay = 50) {
            let index = 0;

            function moveToNext() {
                if (index >= path.length) {
                    return; // –ö–æ–Ω–µ—Ü –ø—É—Ç–∏
                }

                const coord = path[index];
                movePiece(piece, coord);

                index++;
                setTimeout(moveToNext, delay);
            }

            moveToNext();
        }

        // –°–æ–∑–¥–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ–¥—Å–≤–µ—Ç–∫–∏
        function createHighlightElement(rect) {
            const highlight = document.createElement('div');
            highlight.className = 'tutorial-highlight tutorial-highlight-multi';
            highlight.style.position = 'absolute';
            highlight.style.border = '4px solid #FFD700';
            highlight.style.borderRadius = '15px';
            highlight.style.boxShadow = '0 0 30px rgba(255, 215, 0, 0.8), inset 0 0 30px rgba(255, 215, 0, 0.3)';
            highlight.style.zIndex = '100';
            highlight.style.pointerEvents = 'none';
            highlight.style.animation = 'tutorialPulse 2s ease-in-out infinite';
            highlight.style.left = (rect.left - 10) + 'px';
            highlight.style.top = (rect.top - 10) + 'px';
            highlight.style.width = (rect.width + 20) + 'px';
            highlight.style.height = (rect.height + 20) + 'px';
            document.body.appendChild(highlight);
        }

        // –í—ã–¥–µ–ª–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ —Ä–∞–º–∫–∞–º–∏
        function highlightMultiple(selectors) {
            const highlight = document.getElementById('tutorial-highlight');
            highlight.style.display = 'none';

            selectors.forEach(selector => {
                const element = document.querySelector(selector);
                if (element) {
                    const rect = element.getBoundingClientRect();
                    // –ü–µ—Ä–µ–¥–∞–µ–º pageX/pageY –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å —É—á–µ—Ç–æ–º –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
                    createHighlightElement({
                        left: rect.left + window.scrollX,
                        top: rect.top + window.scrollY,
                        width: rect.width,
                        height: rect.height
                    });
                }
            });
        }

        // ================================
        // –ù–û–í–´–ï –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ü–†–û–¶–ï–î–£–†–ù–û–ì–û –û–ù–ë–û–†–î–ò–ù–ì–ê
        // ================================

        // –ü—Ä–æ—Å—Ç–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
		
		function nextStep (btn, delay = 1000) {
			setTimeout(() => {
				btn.disabled = false;
				btn.classList.add('tutorial-button-active');
				btn.click();
				btn.disabled = true;
			}, delay);
}
		
		

        // –ü–æ–∫–∞–∑–∞—Ç—å —à–∞–≥ –æ–±—É—á–µ–Ω–∏—è –∏ –¥–æ–∂–¥–∞—Ç—å—Å—è –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏
        function showStep(config) {
            return new Promise((resolve) => {
                const { stepNumber, totalSteps, message, buttonText, highlight, highlightType, onShow } = config;

                // –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ —à–∞–≥–æ–≤
                const counter = document.getElementById('tutorial-step-counter');
                if (stepNumber === 0) {
                    counter.innerHTML = '<span class="step-number">–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å?</span>';
                } else {
                    counter.innerHTML = `–®–∞–≥ <span class="step-number">${stepNumber}</span> –∏–∑ ${totalSteps}`;
                }

                // –û–±–Ω–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
                updateGameMessage(message);

                // –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
                const btn = document.getElementById('random-move-btn');
                btn.textContent = buttonText || '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';
                btn.disabled = false;
                btn.classList.add('tutorial-button-active');

                // –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫—É
                clearHighlight();
                if (highlight) {
                    if (highlightType === 'zone') {
                        highlightZone(highlight);
                    } else if (highlightType === 'multiple') {
                        highlightMultiple(highlight);
                    } else {
                        highlightElement(highlight);
                    }
                }

                // –í—ã–∑–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É, –µ—Å–ª–∏ –µ—Å—Ç—å
                if (onShow && typeof onShow === 'function') {
                    onShow();
                }

                // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É (–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω—ã–π)
                const clickHandler = () => {
                    btn.removeEventListener('click', clickHandler);
                    btn.classList.remove('tutorial-button-active');
                    resolve();
                };
                btn.addEventListener('click', clickHandler);
            });
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –±—Ä–æ—Å–∫–∞ –∫—É–±–∏–∫–æ–≤
        async function animateDiceRoll(player, values) {
            const dice1 = document.getElementById(`player-dice-${player}-1`);
            const dice2 = document.getElementById(`player-dice-${player}-2`);

            dice1.classList.add('rolling');
            dice2.classList.add('rolling');

            const animationInterval = setInterval(() => {
                const randomValue1 = Math.floor(Math.random() * 6) + 1;
                const randomValue2 = Math.floor(Math.random() * 6) + 1;
                updatePlayerDiceFace(dice1, randomValue1);
                updatePlayerDiceFace(dice2, randomValue2);
            }, 100);

            await delay(1500);

            clearInterval(animationInterval);

            updatePlayerDiceFace(dice1, values[0]);
            updatePlayerDiceFace(dice2, values[1]);

            dice1.classList.remove('rolling');
            dice2.classList.remove('rolling');

            lastDiceRoll = values;
            diceUsed = [false, false];
        }

        // –í—ã–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ñ–∏—à–∫—É –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ
        async function selectAndMovePiece(pieceId, targetCoord) {
            const piece = document.querySelector(`.piece[data-id="${pieceId}"]`);
            if (piece) {
                updateSelectedPiece(piece);
                await delay(1000);
                cachedValidMoves = calculateAndCacheValidMoves(piece);
                performMove(piece, targetCoord);
                await delay(1000);
            } 
        }

        // ================================
        // –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –û–ë–£–ß–ï–ù–ò–Ø (–ü–†–û–¶–ï–î–£–†–ù–´–ô –°–¶–ï–ù–ê–†–ò–ô)
        // ================================

        async function runTutorial() {
            try {
                

                // –®–∞–≥ 0: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
                await showStep({
                    stepNumber: 0,
                    totalSteps: 12,
                    message: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –æ–±—É—á–µ–Ω–∏–µ –∏–≥—Ä–µ –ß–∞—É–ø–∞—Ä! –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –ø–æ—à–∞–≥–æ–≤–æ–µ –∏–∑—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∏–≥—Ä—ã.',
                    buttonText: '–ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ',
                    highlight: null
                });

                // –®–∞–≥ 1: –û—Å–Ω–æ–≤–Ω—ã–µ –∑–æ–Ω—ã –∏–≥—Ä—ã
                await showStep({
                    stepNumber: 1,
                    totalSteps: 12,
                    message: '–°–µ–π—á–∞—Å –ø–µ—Ä–≤—ã–µ —Ñ–∏—à–∫–∏ –æ–±–æ–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç —Å–≤–æ–π –ø—É—Ç—å –æ—Ç –°—Ç–∞—Ä—Ç–æ–≤–æ–π –∑–æ–Ω—ã –∫ –î–æ–º—É –ø–æ –∏–≥—Ä–æ–≤–æ–º—É –ø–æ–ª—é. –¶–µ–ª—å ‚Äî –¥–æ–≤–µ—Å—Ç–∏ <u>–≤—Å–µ</u> —Å–≤–æ–∏ —Ñ–∏—à–∫–∏ –¥–æ —Å–≤–æ–µ–≥–æ –¥–æ–º–∞ —Ä–∞–Ω—å—à–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–≤.',
                    buttonText: '–ü–æ–Ω—è—Ç–Ω–æ',
                    highlight: [
                        '[data-coord="M1"], [data-coord="O2"]',
                        '[data-coord="H1"], [data-coord="H6"]'
                    ],
                    highlightType: 'zone',
                    onShow: () => {
                        setTimeout(() => {
                            const redPiece = document.querySelector('.piece.player1[data-id="p1_0"]');
                            if (redPiece) {
                                const tutorialPath = ['M1', 'K1', ...PLAYER_PATHS[1]];
                                animatePieceAlongPath(redPiece, tutorialPath, 100);
                            }
                        }, 500);

                        setTimeout(() => {
                            const yelPiece = document.querySelector('.piece.player2[data-id="p2_0"]');
                            if (yelPiece) {
                                const tutorialPath = ['E14', ...PLAYER_PATHS[2]];
                                animatePieceAlongPath(yelPiece, tutorialPath, 100);
                            }
                        }, 1000);
                    }
                });

                // –®–∞–≥ 2: –ö—É–±–∏–∫–∏ - –æ–∂–∏–¥–∞–Ω–∏–µ –∫–ª–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const dice1 = document.getElementById('player-dice-1-1');
                const dice2 = document.getElementById('player-dice-1-2');

                await showStep({
                    stepNumber: 2,
                    totalSteps: 12,
                    message: '–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –±—Ä–æ—Å–∏—Ç—å –∫–æ—Å—Ç–∏! –í—ã–ø–∞–≤—à–∏–µ —á–∏—Å–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, –Ω–∞—Å–∫–æ–ª—å–∫–æ –∫–ª–µ—Ç–æ–∫ —Ñ–∏—à–∫–∞ –º–æ–∂–µ—Ç —Å—Ö–æ–¥–∏—Ç—å. –ï—Å–ª–∏ –≤—ã–ø–∞–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è 1 –∏ 1 –∏–ª–∏ 6 –∏ 6 ‚Äî –ø–æ–ª—É—á–∞–µ—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ö–æ–¥!',
                    buttonText: '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å',
                    highlight: '[id^="player-dice-1-"]',
                    highlightType: 'element',
                    onShow: () => {
                        const btn = document.getElementById('random-move-btn');
                        btn.disabled = true;
                        btn.classList.remove('tutorial-button-active');

                        const diceClickHandler = async () => {
                            await animateDiceRoll(1, [3, 1]);

                            dice1.removeEventListener('click', diceClickHandler);
                            dice2.removeEventListener('click', diceClickHandler);
                            //dice1.classList.remove('active');
                            //dice2.classList.remove('active');
							

                            await delay(500);
							
                            btn.disabled = false;
							btn.click();
                        };

                        dice1.addEventListener('click', diceClickHandler);
                        dice2.addEventListener('click', diceClickHandler);
                        dice1.classList.add('active');
                        dice2.classList.add('active');
                    }
                });

                // –®–∞–≥ 3: –°—Ç–∞—Ä—Ç–æ–≤–∞—è –∑–æ–Ω–∞ - –∫—Ä–∞—Å–Ω—ã–π –∏–≥—Ä–æ–∫ –¥–µ–ª–∞–µ—Ç —Ö–æ–¥
                await showStep({
                    stepNumber: 3,
                    totalSteps: 12,
                    message: '–°—Ç–∞—Ä—Ç–æ–≤–∞—è –∑–æ–Ω–∞ ‚Äì –∑–¥–µ—Å—å –Ω–∞—á–∏–Ω–∞—é—Ç –≤—Å–µ —Ñ–∏—à–∫–∏. –ß—Ç–æ–±—ã –≤—ã–≤–µ—Å—Ç–∏ —Ñ–∏—à–∫—É –Ω–∞ –ø–æ–ª–µ, –Ω—É–∂–Ω–æ –≤—ã–±—Ä–æ—Å–∏—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –µ–¥–∏–Ω–∏—Ü—É: –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É —Ñ–∏—à–∫–∞ –≤—ã—Ö–æ–¥–∏—Ç –≤ –∑–æ–Ω—É –æ–∂–∏–¥–∞–Ω–∏—è, –∞ –Ω–∞ –≤—Ç–æ—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å —Ö–æ–¥ –ø–æ –ø–æ–ª—é. –í—ã–±–µ—Ä–∏—Ç–µ –ª—é–±—É—é —Ñ–∏—à–∫—É –∏ —Å–¥–µ–ª–∞–π—Ç–µ —Ö–æ–¥ –Ω–∞ 1 ‚Äì –≤ –∑–æ–Ω—É –æ–∂–∏–¥–∞–Ω–∏—è, –∞ –∑–∞—Ç–µ–º –ø–æ –∏–≥—Ä–æ–≤–æ–º—É –ø–æ–ª—é –Ω–∞ 3.',
                    buttonText: '–î–∞–ª–µ–µ',
                    highlight: '[data-coord="M1"], [data-coord="O2"]',
                    highlightType: 'zone',
                    onShow: () => {
                        const btn = document.getElementById('random-move-btn');
                        btn.disabled = true;
                        btn.classList.remove('tutorial-button-active');

                        const redPiecesInStart = document.querySelectorAll('.piece.player1');

                        const pieceClickHandler = (event) => {
                            const piece = event.currentTarget;
                            if (selectedPiece === piece) {                         
								updateSelectedPiece(null);
                            } else {
                                highlightZone ('[data-coord="K1"], [data-coord="K4"]');
								updateSelectedPiece(piece);
                            }
                        };

                        const cellClickHandler = (event) => {
                            const cell = event.currentTarget;
                            const coord = cell.dataset.coord;
                            if (selectedPiece && cell.classList.contains('possible-move')) {
                                performMove(selectedPiece, coord);

                                const allDiceUsed = diceUsed[0] && diceUsed[1];
                                if (allDiceUsed) {
                                    redPiecesInStart.forEach(p => {
                                        p.removeEventListener('click', pieceClickHandler);
                                        p.style.cursor = '';
                                    });
                                    document.querySelectorAll('.cell').forEach(c => {
                                        c.removeEventListener('click', cellClickHandler);
                                    });
                                    
									nextStep (btn);
									
                                }
                            }
                        };

                        redPiecesInStart.forEach(piece => {
                            piece.addEventListener('click', pieceClickHandler);
                            piece.style.cursor = 'pointer';
                        });
                        document.querySelectorAll('.cell').forEach(cell => {
                            cell.addEventListener('click', cellClickHandler);
                        });
                    }
                });

                // –®–∞–≥ 3b: –•–æ–¥ –∂–µ–ª—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
                
				clearHighlight ();
				updateGameMessage('–¢–µ–ø–µ—Ä—å —Ö–æ–¥ –∂–µ–ª—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞.');
                await delay(1000);

                currentPlayer = 2;
                updatePlayerDiceStates();

                await animateDiceRoll(2, [1, 6]);
                await delay(500);

                await selectAndMovePiece('p2_5', 'E15');
                await selectAndMovePiece('p2_5', 'G10');
				
                // –ü–µ—Ä–µ–¥–∞–µ–º —Ö–æ–¥ –∫—Ä–∞—Å–Ω–æ–º—É –∏–≥—Ä–æ–∫—É
                currentPlayer = 1;
                updatePlayerDiceStates();                

                // –ù–æ–≤—ã–π —à–∞–≥ —Å –±—Ä–æ—Å–∫–æ–º 2:2
                await showStep({
                    stepNumber: 4,
                    totalSteps: 12,
                    message: '–í–∞—à–∞ –æ—á–µ—Ä–µ–¥—å, –±—Ä–æ—Å–∞–π—Ç–µ –∫—É–±–∏–∫–∏!',
                    buttonText: '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å',
                    highlight: '[id^="player-dice-1-"]',
                    highlightType: 'element',
                    onShow: () => {
                        const btn = document.getElementById('random-move-btn');
                        btn.disabled = true;
                        btn.classList.remove('tutorial-button-active');

                        // –ü–æ–ª—É—á–∞–µ–º –∫—É–±–∏–∫–∏ –≤–Ω—É—Ç—Ä–∏ onShow
                        const dice1 = document.getElementById('player-dice-1-1');
                        const dice2 = document.getElementById('player-dice-1-2');

                        const diceClickHandler = async () => {
                            // –ê–Ω–∏–º–∞—Ü–∏—è –±—Ä–æ—Å–∫–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º 2:2
                            await animateDiceRoll(1, [2, 2]);

                            // –û—á–∏—Å—Ç–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–ª–∏–∫)
                            dice1.removeEventListener('click', diceClickHandler);
                            dice2.removeEventListener('click', diceClickHandler);
							clearHighlight ();
							highlightElement('[data-coord="I3"]');  // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —è—á–µ–π–∫—É I3
							updateGameMessage('–í—ã–ø–∞–ª–æ 2:2! –¢–∞–∫ –∫–∞–∫ —Å–µ–π—á–∞—Å –Ω–µ –≤—ã–ø–∞–ª–æ –µ–¥–∏–Ω–∏—Ü—ã, –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ö–æ–¥ —Ç–æ–ª—å–∫–æ —Ç–æ–π —Ñ–∏—à–∫–æ–π, —á—Ç–æ —É–∂–µ –Ω–∞ –ø–æ–ª–µ. –©–µ–ª–∫–Ω–∏—Ç–µ –ø–æ —Ñ–∏—à–∫–µ –∏ –ø–µ—Ä–µ–¥–≤–∏–Ω—å—Ç–µ –µ–µ –Ω–∞ 4 —Ö–æ–¥–∞.');
                            

                            // –ü–∞—É–∑–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º
                            await delay(2000);

                            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
                            btn.click();
                        };

                        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
                        dice1.addEventListener('click', diceClickHandler);
                        dice2.addEventListener('click', diceClickHandler);
                        dice1.classList.add('active');
                        dice2.classList.add('active');
						
						
                        const redPiecesInStart = document.querySelectorAll('.piece.player1');

                        const pieceClickHandler = (event) => {
                            const piece = event.currentTarget;
                            if (selectedPiece === piece) {                              
								updateSelectedPiece(null);
                            } else {
                                clearHighlight ();
								updateSelectedPiece(piece);
                            }
                        };

                        const cellClickHandler = (event) => {
                            const cell = event.currentTarget;
                            const coord = cell.dataset.coord;
                            if (selectedPiece && cell.classList.contains('possible-move')) {
                                performMove(selectedPiece, coord);

                                const allDiceUsed = diceUsed[0] && diceUsed[1];
                                if (allDiceUsed) {
                                    redPiecesInStart.forEach(p => {
                                        p.removeEventListener('click', pieceClickHandler);
                                        p.style.cursor = '';
                                    });
                                    document.querySelectorAll('.cell').forEach(c => {
                                        c.removeEventListener('click', cellClickHandler);
                                    });

                                    nextStep (btn);
                                }
                            }
                        };

                        redPiecesInStart.forEach(piece => {
                            piece.addEventListener('click', pieceClickHandler);
                            piece.style.cursor = 'pointer';
                        });
                        document.querySelectorAll('.cell').forEach(cell => {
                            cell.addEventListener('click', cellClickHandler);
                        });
						
                    }
                });
				//–®–∞–≥ 5: –¢–µ–ª–µ–ø–æ—Ä—Ç
				await showStep({
                    stepNumber: 5,
                    totalSteps: 12,
                    message: '–°–µ–π—á–∞—Å —Ñ–∏—à–∫–∞ –≤ —Ç–µ–ª–µ–ø–æ—Ä—Ç–µ ‚Äî –æ—Å–æ–±–æ–µ –ø–æ–ª–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞. –ï—Å–ª–∏ —Ñ–∏—à–∫–∞ —Å—é–¥–∞ –ø–æ–ø–∞–ª–∞, <u> –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º –±—Ä–æ—Å–∫–µ –∫—É–±–∏–∫–æ–≤ </u> –æ–Ω–∞ –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Å–∫–æ—á–∏—Ç—å –≤–ø–µ—Ä—ë–¥:<div style="text-align: left;">      \t\t‚Ä¢ –Ω–∞ 1Ô∏è‚É£ ‚Äî –≤ —Ç–µ–ª–µ–ø–æ—Ä—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞,\n      \t\t‚Ä¢ –Ω–∞ 3Ô∏è‚É£ ‚Äî –≤ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–π –ø–æ –¥–∏–∞–≥–æ–Ω–∞–ª–∏,\n      \t\t‚Ä¢ –Ω–∞ 6Ô∏è‚É£ ‚Äî –≤ –±–ª–∏–∂–Ω–∏–π –∫ –¥–æ–º—É. </div>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–ª–µ–ø–æ—Ä—Ç—ã, —á—Ç–æ–±—ã –æ–±–æ–≥–Ω–∞—Ç—å —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–≤!',
					buttonText: '–ü–æ–Ω—è—Ç–Ω–æ',
                    highlight: '[data-coord="I7"]',  // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —Ç–µ–ª–µ–ø–æ—Ä—Ç –∫—Ä–∞—Å–Ω–æ–≥–æ
					highlightType: 'element',
					onShow: () => {
						// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–ª–µ–ø–æ—Ä—Ç–Ω—ã–µ —Ö–∏–Ω—Ç—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ–∏—à–∫–∏ –Ω–∞ I7
							// –•–∏–Ω—Ç –Ω–∞ I9 (—Ç–µ–ª–µ–ø–æ—Ä—Ç –Ω–∞ 1)
							const cellI9 = document.querySelector('[data-coord="I9"]');
							if (cellI9) {
								const hint1 = document.createElement('div');
								hint1.className = 'move-hint teleport-hint';
								hint1.textContent = '–¢1';
								cellI9.appendChild(hint1);
								cellI9.classList.add('possible-move');
							}
							// –•–∏–Ω—Ç –Ω–∞ G9 (—Ç–µ–ª–µ–ø–æ—Ä—Ç –Ω–∞ 3)
							const cellG9 = document.querySelector('[data-coord="G9"]');
							if (cellG9) {
								const hint1 = document.createElement('div');
								hint1.className = 'move-hint teleport-hint';
								hint1.textContent = '–¢3';
								cellG9.appendChild(hint1);
								cellG9.classList.add('possible-move');
							}

							// –•–∏–Ω—Ç –Ω–∞ G7 (—Ç–µ–ª–µ–ø–æ—Ä—Ç –Ω–∞ 6)
							const cellG7 = document.querySelector('[data-coord="G7"]');
							if (cellG7) {
								const hint2 = document.createElement('div');
								hint2.className = 'move-hint teleport-hint';
								hint2.textContent = '–¢6';
								cellG7.appendChild(hint2);
								cellG7.classList.add('possible-move');
							}
						
					}
					});
					
					// –®–∞–≥ 5b: –•–æ–¥ –∂–µ–ª—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
					const btn = document.getElementById('random-move-btn');btn.disabled = true;
					btn.classList.remove('tutorial-button-active');
					clearMoveHints();				
					clearHighlight();
					updateGameMessage('–¢–µ–ø–µ—Ä—å —Ö–æ–¥ –∂–µ–ª—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞.');
					await delay(1000);

					currentPlayer = 2;
					updatePlayerDiceStates();

					await animateDiceRoll(2, [2, 5]);
					await delay(500);
					await selectAndMovePiece('p2_5', 'A9');
					
					await delay(1000);

					currentPlayer = 1;
					updatePlayerDiceStates();					
					
					
				// –®–∞–≥ 6: –¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è
                await showStep({
                    stepNumber: 6,
                    totalSteps: 12,
                    message: '–ñ–µ–ª—Ç—ã–π –∏–≥—Ä–æ–∫ —Å–¥–µ–ª–∞–ª —Å–≤–æ–π —Ö–æ–¥. –ë—Ä–æ—Å–∞–π—Ç–µ –∫—É–±–∏–∫–∏ –∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º, –ø–æ–ª—É—á–∏—Ç—Å—è –ª–∏ —É –≤–∞—Å —É—Å–∫–æ—Ä–∏—Ç—å —Ö–æ–¥!',
                    buttonText: '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å',
                    highlight: null,
                    onShow: () => {
                        const btn = document.getElementById('random-move-btn');
                        btn.disabled = true;
                        btn.classList.remove('tutorial-button-active');

                        // –ü–æ–ª—É—á–∞–µ–º –∫—É–±–∏–∫–∏ –≤–Ω—É—Ç—Ä–∏ onShow
                        const dice1 = document.getElementById('player-dice-1-1');
                        const dice2 = document.getElementById('player-dice-1-2');

                        const diceClickHandler = async () => {
                            // –ê–Ω–∏–º–∞—Ü–∏—è –±—Ä–æ—Å–∫–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º 3:4
                            await animateDiceRoll(1, [3, 4]);

                            // –û—á–∏—Å—Ç–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–ª–∏–∫)
                            dice1.removeEventListener('click', diceClickHandler);
                            dice2.removeEventListener('click', diceClickHandler);

							updateGameMessage('–í–∞–º –ø–æ–≤–µ–∑–ª–æ! –ù–∞ 3 –≤—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ñ–∏—à–∫—É –≤ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–π –ø–æ –¥–∏–∞–≥–æ–Ω–∞–ª–∏ —Ç–µ–ª–µ–ø–æ—Ä—Ç, –∞ –Ω–∞ 4 —Å—Ö–æ–¥–∏—Ç—å –¥–∞–ª—å—à–µ. –©–µ–ª–∫–Ω–∏—Ç–µ –Ω–∞ —Ñ–∏—à–∫—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ö–æ–¥—ã!');

                            // –ù–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ - –∂–¥–µ–º –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                            await delay(500);
                        };

                        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
                        dice1.addEventListener('click', diceClickHandler);
                        dice2.addEventListener('click', diceClickHandler);
                        dice1.classList.add('active');
                        dice2.classList.add('active');


                        const redPiecesInStart = document.querySelectorAll('.piece.player1');

                        const pieceClickHandler = (event) => {
                            const piece = event.currentTarget;
                            if (selectedPiece === piece) {
                                updateSelectedPiece(null, true); // true = –æ—á–∏—Å—Ç–∏—Ç—å —Ö–∏–Ω—Ç—ã
                            } else {
                                // –í—ã–¥–µ–ª—è–µ–º —Ñ–∏—à–∫—É –±–µ–∑ –ø–æ–∫–∞–∑–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ö–∏–Ω—Ç–æ–≤
                                if (selectedPiece) {
                                    selectedPiece.classList.remove('selected');
                                }
                                selectedPiece = piece;
                                piece.classList.add('selected');

                                // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Ö–∏–Ω—Ç—ã
                                clearMoveHints();

                                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–ª–µ–ø–æ—Ä—Ç–Ω—ã–µ —Ö–∏–Ω—Ç—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ–∏—à–∫–∏ –Ω–∞ I7
                                const pieceCoord = getCurrentPosition(piece);
                                if (pieceCoord === 'I7') {
                                    // –•–∏–Ω—Ç –Ω–∞ G9 (—Ç–µ–ª–µ–ø–æ—Ä—Ç –Ω–∞ 3)
                                    const cellG9 = document.querySelector('[data-coord="G9"]');
                                    if (cellG9) {
                                        const hint1 = document.createElement('div');
                                        hint1.className = 'move-hint teleport-hint';
                                        hint1.textContent = '–¢3';
                                        cellG9.appendChild(hint1);
                                        cellG9.classList.add('possible-move');
                                    }

                                    // –•–∏–Ω—Ç –Ω–∞ C9 (—Ç–µ–ª–µ–ø–æ—Ä—Ç + 4 —à–∞–≥–∞ = 7)
                                    const cellC9 = document.querySelector('[data-coord="C9"]');
                                    if (cellC9) {
                                        const hint2 = document.createElement('div');
                                        hint2.className = 'move-hint';
                                        hint2.textContent = '–¢7';
                                        cellC9.appendChild(hint2);
                                        cellC9.classList.add('possible-move');
                                    }
                                }
                                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–µ —Ö–∏–Ω—Ç—ã –¥–ª—è —Ñ–∏—à–∫–∏ –Ω–∞ G9 —Å –∫—É–±–∏–∫–æ–º 4
                                else if (pieceCoord === 'G9' && diceUsed[0] && !diceUsed[1]) {
                                    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ü–µ–ª–µ–≤—É—é –∫–ª–µ—Ç–∫—É: G9 + 4 —à–∞–≥–∞ –ø–æ –ø—É—Ç–∏ –∂–µ–ª—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞
                                    const yellowPath = PLAYER_PATHS[2]; // –ñ–µ–ª—Ç—ã–π –ø—É—Ç—å
                                    const g9Index = yellowPath.indexOf('G9');
                                    if (g9Index !== -1 && g9Index + 4 < yellowPath.length) {
                                        const targetCoord = yellowPath[g9Index + 4]; // E9
                                        const targetCell = document.querySelector(`[data-coord="${targetCoord}"]`);
                                        if (targetCell) {
                                            const hint = document.createElement('div');
                                            hint.className = 'move-hint';
                                            hint.textContent = '4';
                                            targetCell.appendChild(hint);
                                            targetCell.classList.add('possible-move');
                                        }
                                    }
                                }
                            }
                        };

                        const cellClickHandler = async (event) => {
                            const cell = event.currentTarget;
                            const coord = cell.dataset.coord;

                            if (selectedPiece && cell.classList.contains('possible-move')) {
                                const pieceCoord = getCurrentPosition(selectedPiece);

                                // –ö–ª–∏–∫ –Ω–∞ G9 - —Ç–µ–ª–µ–ø–æ—Ä—Ç –Ω–∞ 3, –æ—Å—Ç–∞–µ—Ç—Å—è –∫—É–±–∏–∫ 4
                                if (coord === 'G9' && pieceCoord === 'I7') {
                                    // –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ñ–∏—à–∫—É –Ω–∞ G9 –Ω–∞–ø—Ä—è–º—É—é (–±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏)
                                    movePiece(selectedPiece, 'G9');

                                    // –û—Ç–º–µ—á–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—É–±–∏–∫–∞ 3
                                    diceUsed[0] = true;

                                    // –û—á–∏—â–∞–µ–º —Ö–∏–Ω—Ç—ã
                                    clearMoveHints();

                                    // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å —Ñ–∏—à–∫–∏
                                    updateSelectedPiece(null, true);

                                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ö–æ–¥–∞
                                    updateGameMessage('–í—ã —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å –Ω–∞ 3! –¢–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å —ç—Ç—É —Ñ–∏—à–∫—É —Å–Ω–æ–≤–∞ –∏ —Å—Ö–æ–¥–∏—Ç—å –Ω–∞ 4.');

                                    // –ù–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É - –∂–¥–µ–º –≤—Ç–æ—Ä–æ–≥–æ —Ö–æ–¥–∞

                                }
                                // –ö–ª–∏–∫ –Ω–∞ C9 - —Ç–µ–ª–µ–ø–æ—Ä—Ç –Ω–∞ 3 + –¥–≤–∏–∂–µ–Ω–∏–µ –Ω–∞ 4 (—Å—Ä–∞–∑—É)
                                else if (coord === 'C9' && pieceCoord === 'I7') {
                                    // –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ñ–∏—à–∫—É —Å—Ä–∞–∑—É –Ω–∞ C9 –Ω–∞–ø—Ä—è–º—É—é (–±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏)
                                    movePiece(selectedPiece, 'C9');

                                    // –û—Ç–º–µ—á–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±–æ–∏—Ö –∫—É–±–∏–∫–æ–≤
                                    diceUsed[0] = true;
                                    diceUsed[1] = true;

                                    // –û—á–∏—â–∞–µ–º —Ö–∏–Ω—Ç—ã
                                    clearMoveHints();

                                    // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å —Ñ–∏—à–∫–∏
                                    updateSelectedPiece(null, true);

                                    updateGameMessage('–û—Ç–ª–∏—á–Ω—ã–π —Ö–æ–¥! –í—ã —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å –∏ –ø—Ä–æ—à–ª–∏ –¥–∞–ª—å—à–µ –Ω–∞ 4 –∫–ª–µ—Ç–∫–∏.');

                                    // –û—á–∏—â–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
                                    redPiecesInStart.forEach(p => {
                                        p.removeEventListener('click', pieceClickHandler);
                                        p.style.cursor = '';
                                    });
                                    document.querySelectorAll('.cell').forEach(c => {
                                        c.removeEventListener('click', cellClickHandler);
                                    });

                                    nextStep (btn);
                                }
                                // –û–±—ã—á–Ω—ã–π —Ö–æ–¥ —Å G9 –Ω–∞ 4 (–ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞)
                                else if (pieceCoord === 'G9' && !diceUsed[1]) {
                                    // –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ñ–∏—à–∫—É –Ω–∞–ø—Ä—è–º—É—é (–±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏)
                                    movePiece(selectedPiece, coord);

                                    // –û—Ç–º–µ—á–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∫—É–±–∏–∫–∞
                                    diceUsed[1] = true;

                                    clearMoveHints();
                                    updateSelectedPiece(null, true);

                                    updateGameMessage('–û—Ç–ª–∏—á–Ω–æ! –í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Ö–æ–¥.');

                                    // –û—á–∏—â–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
                                    redPiecesInStart.forEach(p => {
                                        p.removeEventListener('click', pieceClickHandler);
                                        p.style.cursor = '';
                                    });
                                    document.querySelectorAll('.cell').forEach(c => {
                                        c.removeEventListener('click', cellClickHandler);
                                    });

                                    nextStep (btn);
                                }
                            }
                        };

                        redPiecesInStart.forEach(piece => {
                            piece.addEventListener('click', pieceClickHandler);
                            piece.style.cursor = 'pointer';
                        });
                        document.querySelectorAll('.cell').forEach(cell => {
                            cell.addEventListener('click', cellClickHandler);
                        });
						
                    }
                });
					//–•–æ–¥ –∂–µ–ª—Ç–æ–≥–æ –Ω–∞ 1 –∏ 2
					clearHighlight();
					updateGameMessage('–¢–µ–ø–µ—Ä—å —Ö–æ–¥ –∂–µ–ª—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞.');
					await delay(1000);

					currentPlayer = 2;
					updatePlayerDiceStates();

					await animateDiceRoll(2, [1, 2]);
					await delay(500);
					await selectAndMovePiece('p2_5', 'A7');
					await selectAndMovePiece('p2_4', 'E14');
					
					await delay(1000);

				// –ü–µ—Ä–µ–¥–∞–µ–º —Ö–æ–¥ –∫—Ä–∞—Å–Ω–æ–º—É –∏–≥—Ä–æ–∫—É
                currentPlayer = 1;
                updatePlayerDiceStates();                

                // –ù–æ–≤—ã–π —à–∞–≥ 7 —Å –±—Ä–æ—Å–∫–æ–º 2:3
                await showStep({
                    stepNumber: 7,
                    totalSteps: 12,
                    message: '–ñ–µ–ª—Ç—ã–π –∏–≥—Ä–æ–∫ –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É –≤—ã–≤–µ–ª –µ—â–µ –æ–¥–Ω—É —Ñ–∏—à–∫—É –≤ –∏–≥—Ä—É, –∞ –≤—Ç–æ—Ä—É—é –ø–æ–¥–≤–∏–Ω—É–ª –¥–∞–ª—å—à–µ –ø–æ —Ö–æ–¥—É. –í–∞—à–∞ –æ—á–µ—Ä–µ–¥—å, –±—Ä–æ—Å–∞–π—Ç–µ –∫—É–±–∏–∫–∏!',
                    buttonText: '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å',
                    highlight: null,
                    onShow: () => {
                        const btn = document.getElementById('random-move-btn');
                        btn.disabled = true;
                        btn.classList.remove('tutorial-button-active');

                        // –ü–æ–ª—É—á–∞–µ–º –∫—É–±–∏–∫–∏ –≤–Ω—É—Ç—Ä–∏ onShow
                        const dice1 = document.getElementById('player-dice-1-1');
                        const dice2 = document.getElementById('player-dice-1-2');

                        const diceClickHandler = async () => {
                            // –ê–Ω–∏–º–∞—Ü–∏—è –±—Ä–æ—Å–∫–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º 4:3
                            await animateDiceRoll(1, [4, 3]);

                            // –û—á–∏—Å—Ç–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–ª–∏–∫)
                            dice1.removeEventListener('click', diceClickHandler);
                            dice2.removeEventListener('click', diceClickHandler);

							updateGameMessage('–ï—Å–ª–∏ —Ñ–∏—à–∫–∞ –¥–æ–≥–æ–Ω—è–µ—Ç —á—É–∂—É—é —Ä–æ–≤–Ω–æ –ø–æ –≤—ã–ø–∞–≤—à–µ–º—É –∑–Ω–∞—á–µ–Ω–∏—é ‚Äî –µ—ë –º–æ–∂–Ω–æ —Å—ä–µ—Å—Ç—å! –°—ä–µ–¥–µ–Ω–Ω–∞—è —Ñ–∏—à–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é. –°—ä–µ—à—å—Ç–µ –∂–µ–ª—Ç—É—é —Ñ–∏—à–∫—É –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–π —Ö–æ–¥.');

                            // –¢–µ–ø–µ—Ä—å –∏—â–µ–º –∂–µ–ª—Ç—É—é —Ñ–∏—à–∫—É –∏ –≤–µ—à–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
                            await delay(500);

                            // –ò—â–µ–º –∂–µ–ª—Ç—É—é —Ñ–∏—à–∫—É —á–µ—Ä–µ–∑ gameBoard
                            let yellowPieceOnA7 = null;
                            if (gameBoard['A7']) {
                                const pieceOnA7 = Array.isArray(gameBoard['A7']) ? gameBoard['A7'][0] : gameBoard['A7'];
                                if (pieceOnA7 && parseInt(pieceOnA7.dataset.player) === 2) {
                                    yellowPieceOnA7 = pieceOnA7;
                                }
                            }
                            

                            if (yellowPieceOnA7) {
                                yellowPieceOnA7.addEventListener('click', captureHandler);
                                yellowPieceOnA7.style.cursor = 'pointer';
                            }
                        };

                        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
                        dice1.addEventListener('click', diceClickHandler);
                        dice2.addEventListener('click', diceClickHandler);
                        dice1.classList.add('active');
                        dice2.classList.add('active');


                        const redPiecesInStart = document.querySelectorAll('.piece.player1');

                        const pieceClickHandler = (event) => {
                            const piece = event.currentTarget;
                            if (selectedPiece === piece) {
                                updateSelectedPiece(null, true); // true = –æ—á–∏—Å—Ç–∏—Ç—å —Ö–∏–Ω—Ç—ã
                            } else {
                                // –í—ã–¥–µ–ª—è–µ–º —Ñ–∏—à–∫—É –±–µ–∑ –ø–æ–∫–∞–∑–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ö–∏–Ω—Ç–æ–≤
                                if (selectedPiece) {
                                    selectedPiece.classList.remove('selected');
                                }
                                selectedPiece = piece;
                                piece.classList.add('selected');

                                // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Ö–∏–Ω—Ç—ã
                                clearMoveHints();

                                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ö–∏–Ω—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–∑–∏—Ü–∏–∏ —Ñ–∏—à–∫–∏
                                const pieceCoord = getCurrentPosition(piece);

                                // –ï—Å–ª–∏ —Ñ–∏—à–∫–∞ –Ω–∞ C9 - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ö–∏–Ω—Ç –Ω–∞ A7 (4 —à–∞–≥–∞ –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞)
                                if (pieceCoord === 'C9' && !diceUsed[0]) {
                                    const cellA7 = document.querySelector('[data-coord="A7"]');
                                    if (cellA7) {
                                        const hint = document.createElement('div');
                                        hint.className = 'move-hint';
                                        hint.textContent = '4';
                                        cellA7.appendChild(hint);
                                        cellA7.classList.add('possible-move');
                                    }
                                }
                                // –ï—Å–ª–∏ —Ñ–∏—à–∫–∞ –Ω–∞ A7 (–ø–æ—Å–ª–µ –∑–∞—Ö–≤–∞—Ç–∞) - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ö–∏–Ω—Ç –Ω–∞ D7 (3 —à–∞–≥–∞)
                                else if (pieceCoord === 'A7' && diceUsed[0] && !diceUsed[1]) {
                                    const cellD7 = document.querySelector('[data-coord="D7"]');
                                    if (cellD7) {
                                        const hint = document.createElement('div');
                                        hint.className = 'move-hint';
                                        hint.textContent = '3';
                                        cellD7.appendChild(hint);
                                        cellD7.classList.add('possible-move');
                                    }
                                }
                            }
                        };

                        const cellClickHandler = async (event) => {
                            const cell = event.currentTarget;
                            const coord = cell.dataset.coord;

                            if (selectedPiece && cell.classList.contains('possible-move')) {
                                const pieceCoord = getCurrentPosition(selectedPiece);

                                
                                // –ö–ª–∏–∫ –Ω–∞ D7 - –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ö–æ–¥–∞ –Ω–∞ 3
                                if (coord === 'D7' && pieceCoord === 'A7') {
                                    // –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ñ–∏—à–∫—É –Ω–∞ D7
                                    movePiece(selectedPiece, 'D7');

                                    // –û—Ç–º–µ—á–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—É–±–∏–∫–∞ 3
                                    diceUsed[1] = true;

                                    clearMoveHints();
                                    updateSelectedPiece(null, true);

                                    // updateGameMessage('–û—Ç–ª–∏—á–Ω–æ! –í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Ö–æ–¥ –ø–æ—Å–ª–µ –∑–∞—Ö–≤–∞—Ç–∞.');

                                    // –û—á–∏—â–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
                                    redPiecesInStart.forEach(p => {
                                        p.removeEventListener('click', pieceClickHandler);
                                        p.style.cursor = '';
                                    });
                                    document.querySelectorAll('.cell').forEach(c => {
                                        c.removeEventListener('click', cellClickHandler);
                                    });

                                    nextStep (btn);
                                }
                            }
                        };

                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º captureHandler –î–û —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω
                        const captureHandler = async (event) => {
                            event.stopPropagation(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ —Å–æ–±—ã—Ç–∏—è
                            const yellowPiece = event.currentTarget;
                            const yellowCoord = getCurrentPosition(yellowPiece);

                            // –ï—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ –∂–µ–ª—Ç—É—é —Ñ–∏—à–∫—É –Ω–∞ A7, –∫–æ–≥–¥–∞ –≤—ã–¥–µ–ª–µ–Ω–∞ –∫—Ä–∞—Å–Ω–∞—è –Ω–∞ C9
                            if (yellowCoord === 'A7' && selectedPiece) {
                                const selectedCoord = getCurrentPosition(selectedPiece);
                                

                                if (selectedCoord === 'C9') {
                                    

                                    // –£–±–∏—Ä–∞–µ–º –∂–µ–ª—Ç—É—é —Ñ–∏—à–∫—É
                                    movePiece(yellowPiece, 'C15');

                                    // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∫—Ä–∞—Å–Ω—É—é —Ñ–∏—à–∫—É –Ω–∞ A7
                                    movePiece(selectedPiece, 'A7');

                                    // –û—Ç–º–µ—á–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—É–±–∏–∫–∞ 4
                                    diceUsed[0] = true;

                                    // –û—á–∏—â–∞–µ–º —Ö–∏–Ω—Ç—ã
                                    clearMoveHints();

                                    // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å —Ñ–∏—à–∫–∏
                                    updateSelectedPiece(null, true);

                                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                                    updateGameMessage('–û–≥–æ! –í—ã —Å—ä–µ–ª–∏ –∂–µ–ª—Ç—É—é —Ñ–∏—à–∫—É! –û–Ω–∞ –≤–µ—Ä–Ω—É–ª–∞—Å—å –Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ö–æ–¥ –∏ –ø–µ—Ä–µ–¥–≤–∏–Ω—É—Ç—å —Å–≤–æ—é —Ñ–∏—à–∫—É  –Ω–∞ 3 —à–∞–≥–∞.');

                                    // –£–¥–∞–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å –∂–µ–ª—Ç–æ–π —Ñ–∏—à–∫–∏
                                    yellowPiece.removeEventListener('click', captureHandler);
                                }
                            }
                        };

                        redPiecesInStart.forEach(piece => {
                            piece.addEventListener('click', pieceClickHandler);
                            piece.style.cursor = 'pointer';
                        });
                        document.querySelectorAll('.cell').forEach(cell => {
                            cell.addEventListener('click', cellClickHandler);
                        });

                    }
				});
				
				//–•–æ–¥ –∂–µ–ª—Ç–æ–≥–æ –Ω–∞ 3 –∏ 4
					clearHighlight();
					updateGameMessage('–¢–µ–ø–µ—Ä—å —Ö–æ–¥ –∂–µ–ª—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞.');
					await delay(1000);

					currentPlayer = 2;
					updatePlayerDiceStates();

					await animateDiceRoll(2, [4, 3]);
					await delay(500);
					await selectAndMovePiece('p2_4', 'G12');
					await selectAndMovePiece('p2_4', 'G9');
					
					await delay(1000);
					// –ü–µ—Ä–µ–¥–∞–µ–º —Ö–æ–¥ –∫—Ä–∞—Å–Ω–æ–º—É –∏–≥—Ä–æ–∫—É
                currentPlayer = 1;
                updatePlayerDiceStates();                

                // –ù–æ–≤—ã–π —à–∞–≥ 8: –≤ –•—Ä–∞–º
                await showStep({
                    stepNumber: 8,
                    totalSteps: 12,
                    message: '–ñ–µ–ª—Ç—ã–π –∏–≥—Ä–æ–∫ –≤—Å—Ç–∞–ª –≤ —Å–≤–æ–π —Ç–µ–ª–µ–ø–æ—Ä—Ç! –í–∞—à–∞ –æ—á–µ—Ä–µ–¥—å, –±—Ä–æ—Å–∞–π—Ç–µ –∫—É–±–∏–∫–∏!',
                    buttonText: '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å',
                    highlight: null,
                    onShow: () => {
                        const btn = document.getElementById('random-move-btn');
                        btn.disabled = true;
                        btn.classList.remove('tutorial-button-active');

                        // –ü–æ–ª—É—á–∞–µ–º –∫—É–±–∏–∫–∏ –≤–Ω—É—Ç—Ä–∏ onShow
                        const dice1 = document.getElementById('player-dice-1-1');
                        const dice2 = document.getElementById('player-dice-1-2');

                        const diceClickHandler = async () => {
                            // –ê–Ω–∏–º–∞—Ü–∏—è –±—Ä–æ—Å–∫–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º 2:3
                            await animateDiceRoll(1, [2, 3]);

                            // –û—á–∏—Å—Ç–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–ª–∏–∫)
                            dice1.removeEventListener('click', diceClickHandler);
                            dice2.removeEventListener('click', diceClickHandler);
							
							updateGameMessage('–í—ã–ø–∞–ª–æ 2:3! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Ö–æ–¥ —Ç–æ–π –∂–µ —Ñ–∏—à–∫–æ–π. –©–µ–ª–∫–Ω–∏—Ç–µ –ø–æ —Ñ–∏—à–∫–µ –∏ –ø–µ—Ä–µ–¥–≤–∏–Ω—å—Ç–µ –µ–µ –Ω–∞ 5 —Ö–æ–¥–æ–≤.');
                            

                            // –ü–∞—É–∑–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º
                            await delay(2000);

                            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
                            btn.click();							

                        };

                        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
                        dice1.addEventListener('click', diceClickHandler);
                        dice2.addEventListener('click', diceClickHandler);
                        dice1.classList.add('active');
                        dice2.classList.add('active');
						
						
                        const redPiecesInStart = document.querySelectorAll('.piece.player1');

                        const pieceClickHandler = (event) => {
                            const piece = event.currentTarget;
                            if (selectedPiece === piece) {
                                updateSelectedPiece(null);
                            } else {
                                updateSelectedPiece(piece);
                            }
                        };

                        const cellClickHandler = (event) => {
                            const cell = event.currentTarget;
                            const coord = cell.dataset.coord;
                            if (selectedPiece && cell.classList.contains('possible-move')) {
                                performMove(selectedPiece, coord);

                                const allDiceUsed = diceUsed[0] && diceUsed[1];
                                if (allDiceUsed) {
                                    redPiecesInStart.forEach(p => {
                                        p.removeEventListener('click', pieceClickHandler);
                                        p.style.cursor = '';
                                    });
                                    document.querySelectorAll('.cell').forEach(c => {
                                        c.removeEventListener('click', cellClickHandler);
                                    });

                                    nextStep (btn);
                                }
                            }
                        };

                        redPiecesInStart.forEach(piece => {
                            piece.addEventListener('click', pieceClickHandler);
                            piece.style.cursor = 'pointer';
                        });
                        document.querySelectorAll('.cell').forEach(cell => {
                            cell.addEventListener('click', cellClickHandler);
                        });
						
                    }
                });
				const pieceOnG5 = gameBoard['G5'];
				if (pieceOnG5) {
					const piece = Array.isArray(pieceOnG5) ? pieceOnG5[0] : pieceOnG5;
					await delay(500);
					movePiece(piece, 'F5'); // –ü—Ä—è–º–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ
					updateGameMessage ('–ï—Å–ª–∏ —Ö–æ–¥ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞–ø—Ä–æ—Ç–∏–≤ —Ö—Ä–∞–º–∞ –∏–ª–∏ —Ç—é—Ä—å–º—ã —Ñ–∏—à–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç—É–¥–∞ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è. <u>–•—Ä–∞–º</u> ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ. –í —Ö—Ä–∞–º–µ —Ñ–∏—à–∫—É –Ω–µ–ª—å–∑—è —Å—ä–µ—Å—Ç—å, –Ω–æ –≤ –∫–∞–∂–¥–æ–º —Ö—Ä–∞–º–µ –æ–Ω–∞ –º–æ–∂–µ—Ç —Å—Ç–æ—è—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞. –ï—Å–ª–∏ —Ö—Ä–∞–º –∑–∞–Ω—è—Ç, –¥—Ä—É–≥–∏–µ –Ω–µ –º–æ–≥—É—Ç –∑–∞–∫–æ–Ω—á–∏—Ç—å —Ö–æ–¥ –≤ —Ö—Ä–∞–º–µ, –Ω–æ –º–æ–≥—É—Ç –ø—Ä–æ–π—Ç–∏ –º–∏–º–æ.');
					}
				highlightMultiple (['[data-coord="F5"]', '[data-coord="E10"]', '[data-coord="J11"]', '[data-coord="K6"]']);					

				// –ü—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –∂–¥–µ–º –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏
				await new Promise((resolve) => {
					const btn = document.getElementById('random-move-btn');
					btn.disabled = false;
					btn.classList.add('tutorial-button-active');

					const clickHandler = () => {
						btn.disabled = true;
						btn.classList.remove('tutorial-button-active');
						btn.removeEventListener('click', clickHandler);
						resolve();
					};

					btn.addEventListener('click', clickHandler);
				});
				await delay(500);
				clearHighlight ();
				await delay(500);
				currentPlayer = 2;
				updatePlayerDiceStates();
				await animateDiceRoll(2, [1, 4]);
				await delay(500);
				const pieceOnG9 = gameBoard['G9'];
				if (pieceOnG9) {
					const piece = Array.isArray(pieceOnG9) ? pieceOnG9[0] : pieceOnG9;
						await delay(500);
						movePiece(piece, 'G7'); // –ü—Ä—è–º–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ
					}
				//await movePiece('p2_4', 'G7');
				await selectAndMovePiece('p2_4', 'G3');
					
				await delay(1000);
					// –ü–µ—Ä–µ–¥–∞–µ–º —Ö–æ–¥ –∫—Ä–∞—Å–Ω–æ–º—É –∏–≥—Ä–æ–∫—É
                currentPlayer = 1;
                updatePlayerDiceStates();
				
                // –ù–æ–≤—ã–π —à–∞–≥ 9: –ü—Ä–æ–ø—É—Å–∫ —Ö–æ–¥–∞
                await showStep({
                    stepNumber: 9,
                    totalSteps: 12,
                    message: '–ñ–µ–ª—Ç—ã–π –∏–≥—Ä–æ–∫ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª—Å—è –≤ –±–ª–∏–∂–∞–π—à–∏–π —Ç–µ–ª–µ–ø–æ—Ä—Ç –Ω–∞ 1 –∏ –Ω–∞ 4 –ø—Ä–æ–¥–æ–ª–∂–∏–ª —Ö–æ–¥. –í–∞—à–∞ –æ—á–µ—Ä–µ–¥—å, –±—Ä–æ—Å–∞–π—Ç–µ –∫—É–±–∏–∫–∏!',
                    buttonText: '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å',
                    highlight: null,
                    onShow: () => {
                        const btn = document.getElementById('random-move-btn');
                        btn.disabled = true;
                        btn.classList.remove('tutorial-button-active');

                        // –ü–æ–ª—É—á–∞–µ–º –∫—É–±–∏–∫–∏ –≤–Ω—É—Ç—Ä–∏ onShow
                        const dice1 = document.getElementById('player-dice-1-1');
                        const dice2 = document.getElementById('player-dice-1-2');

                        const diceClickHandler = async () => {
                            // –ê–Ω–∏–º–∞—Ü–∏—è –±—Ä–æ—Å–∫–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º 2:3
                            await animateDiceRoll(1, [4, 5]);

                            // –û—á–∏—Å—Ç–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–ª–∏–∫)
                            dice1.removeEventListener('click', diceClickHandler);
                            dice2.removeEventListener('click', diceClickHandler);
							
							updateGameMessage('–ò–Ω–æ–≥–¥–∞ —Ö–æ–¥–∞ –Ω–µ—Ç ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –ø—É—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (–ø–µ—Ä–µ–ø—Ä—ã–≥–∏–≤–∞—Ç—å —Ñ–∏—à–∫–∏ –Ω–µ–ª—å–∑—è) –∏–ª–∏ —Ñ–∏—à–∫–∞ –≤ —Ç—é—Ä—å–º–µ. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –∏–≥—Ä–æ–∫ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ö–æ–¥ –∏ –∂–¥—ë—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–æ–ª–µ–µ —É–¥–∞—á–Ω–æ–≥–æ –±—Ä–æ—Å–∫–∞.');
							highlightMultiple (['[data-coord="G3"]']);
							
                            nextStep (btn);							
                        };

                        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
                        dice1.addEventListener('click', diceClickHandler);
                        dice2.addEventListener('click', diceClickHandler);
                        dice1.classList.add('active');
                        dice2.classList.add('active');
																		
                    }
                });
				
				// –ü—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –∂–¥–µ–º –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏
							await new Promise((resolve) => {
								const btn = document.getElementById('random-move-btn');
								btn.disabled = false;
								btn.classList.add('tutorial-button-active');

								const clickHandler = () => {
									btn.disabled = true;
									btn.classList.remove('tutorial-button-active');
									btn.removeEventListener('click', clickHandler);
									resolve();
								};

								btn.addEventListener('click', clickHandler);
							});
							await delay(500);
							clearHighlight ();
							await delay(500);                       

                            
                            
				currentPlayer = 2;
				updatePlayerDiceStates();
				
				await animateDiceRoll(2, [2, 1]);
				await delay(500);
				await selectAndMovePiece('p2_4', 'G1');
				await delay(500);
				await selectAndMovePiece('p2_2', 'E13');					
				await delay(500);
					// –ü–µ—Ä–µ–¥–∞–µ–º —Ö–æ–¥ –∫—Ä–∞—Å–Ω–æ–º—É –∏–≥—Ä–æ–∫—É
                currentPlayer = 1;
                updatePlayerDiceStates();
				
				
				// –®–∞–≥ 10: –¢—é—Ä—å–º–∞
                await showStep({
                    stepNumber: 10,
                    totalSteps: 12,
                    message: '–ñ–µ–ª—Ç—ã–π –∏–≥—Ä–æ–∫ —Å–¥–µ–ª–∞–ª —Å–≤–æ–π —Ö–æ–¥. –ë—Ä–æ—Å–∞–π—Ç–µ –∫—É–±–∏–∫–∏!',
                    buttonText: '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å',
                    highlight: null,
                    onShow: () => {
                        const btn = document.getElementById('random-move-btn');
                        btn.disabled = true;
                        btn.classList.remove('tutorial-button-active');

                        // –ü–æ–ª—É—á–∞–µ–º –∫—É–±–∏–∫–∏ –≤–Ω—É—Ç—Ä–∏ onShow
                        const dice1 = document.getElementById('player-dice-1-1');
                        const dice2 = document.getElementById('player-dice-1-2');

                        const diceClickHandler = async () => {
                            // –ê–Ω–∏–º–∞—Ü–∏—è –±—Ä–æ—Å–∫–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º 3:4
                            await animateDiceRoll(1, [3, 3]);

                            // –û—á–∏—Å—Ç–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–ª–∏–∫)
                            dice1.removeEventListener('click', diceClickHandler);
                            dice2.removeEventListener('click', diceClickHandler);

							updateGameMessage('–ò–∑-–∑–∞ —Å—Ç–æ—è—â–µ–π –∂–µ–ª—Ç–æ–π —Ñ–∏—à–∫–∏ –≤–∞–º –¥–æ—Å—Ç—É–ø–µ–Ω —Ö–æ–¥ —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–Ω—É —Ç—Ä–æ–π–∫—É –∏ –≤—ã –ø–æ–ø–∞–¥–∞–µ—Ç–µ –≤ <u>—Ç—é—Ä—å–º—É</u> ‚Äî —Ç–æ–∂–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ, –Ω–æ —á—Ç–æ–±—ã –≤—ã–π—Ç–∏ –∏–∑ —Ç—é—Ä—å–º—ã, –Ω—É–∂–Ω–æ –≤—ã–±—Ä–æ—Å–∏—Ç—å 6 –Ω–∞ –æ–¥–Ω–æ–º –∏–∑ –∫—É–±–∏–∫–æ–≤ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ç–æ—Ä–æ–π –∫—É–±–∏–∫ –¥–ª—è —Ö–æ–¥–∞. –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å —Ö–æ–¥ —Ç–æ–∂–µ –Ω–µ–ª—å–∑—è, –ø–æ—ç—Ç–æ–º—É –¥–µ–ª–∞–π—Ç–µ —Å–≤–æ–π —Ö–æ–¥.');
							// –ü–æ–¥—Å–≤–µ—Ç–∏–º —Ç—é—Ä—å–º—ã
							highlightMultiple (['[data-coord="F2"]', '[data-coord="B10"]', '[data-coord="J14"]', '[data-coord="N6"]']);					

				

                            // –ù–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ - –∂–¥–µ–º –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                            await delay(500);
                        };

                        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
                        dice1.addEventListener('click', diceClickHandler);
                        dice2.addEventListener('click', diceClickHandler);
                        dice1.classList.add('active');
                        dice2.classList.add('active');


                        const redPiecesInStart = document.querySelectorAll('.piece.player1');

                        const pieceClickHandler = (event) => {
                            const piece = event.currentTarget;
                            if (selectedPiece === piece) {
                                updateSelectedPiece(null, true); // true = –æ—á–∏—Å—Ç–∏—Ç—å —Ö–∏–Ω—Ç—ã
                            } else {
                                // –í—ã–¥–µ–ª—è–µ–º —Ñ–∏—à–∫—É –±–µ–∑ –ø–æ–∫–∞–∑–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ö–∏–Ω—Ç–æ–≤
                                if (selectedPiece) {
                                    clearHighlight ();
									selectedPiece.classList.remove('selected');
                                }
                                selectedPiece = piece;
                                piece.classList.add('selected');

                                // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Ö–∏–Ω—Ç—ã
                                clearMoveHints();

                                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ö–∏–Ω—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ–∏—à–∫–∏ –Ω–∞ F2
                                const pieceCoord = getCurrentPosition(piece);
                                if (pieceCoord === 'F5') {
                                    // –•–∏–Ω—Ç –Ω–∞ F2 (—Ç–µ–ª–µ–ø–æ—Ä—Ç –Ω–∞ 3)
                                    const cellF2 = document.querySelector('[data-coord="F2"]');
                                    if (cellF2) {
                                        const hint1 = document.createElement('div');
                                        hint1.className = 'move-hint';
                                        hint1.textContent = '3';
                                        cellF2.appendChild(hint1);
                                        cellF2.classList.add('possible-move');
                                    }

                                    
                                }
                                
                            }
                        };

                        const cellClickHandler = async (event) => {
                            const cell = event.currentTarget;
                            const coord = cell.dataset.coord;

                            if (selectedPiece && cell.classList.contains('possible-move')) {
                                const pieceCoord = getCurrentPosition(selectedPiece);

                                
                                if (coord === 'F2' && pieceCoord === 'F5') {
                                    
                                    movePiece(selectedPiece, 'F2');

                                    // –û—Ç–º–µ—á–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—É–±–∏–∫–∞ 
                                    diceUsed[0] = true;
									diceUsed[1] = true;

                                    // –û—á–∏—â–∞–µ–º —Ö–∏–Ω—Ç—ã
                                    clearMoveHints();

                                    // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å —Ñ–∏—à–∫–∏
                                    updateSelectedPiece(null, true);

                                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ö–æ–¥–∞
                                    updateGameMessage('–¢–µ–ø–µ—Ä—å —ç—Ç–∞ —Ñ–∏—à–∫–∞ –≤ —Ç—é—Ä—å–º–µ, –±—É–¥–µ–º –∂–¥–∞—Ç—å 6 —Ö–æ—Ç—è –±—ã –Ω–∞ –æ–¥–Ω–æ–º –∏–∑ –∫—É–±–∏–∫–æ–≤ –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ç—é—Ä—å–º—ã.');

                                    // –û—á–∏—â–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
                                    redPiecesInStart.forEach(p => {
                                        p.removeEventListener('click', pieceClickHandler);
                                        p.style.cursor = '';
                                    });
                                    document.querySelectorAll('.cell').forEach(c => {
                                        c.removeEventListener('click', cellClickHandler);
                                    });

                                    nextStep (btn);

                                }                             
                                
                            }
                        };

                        redPiecesInStart.forEach(piece => {
                            piece.addEventListener('click', pieceClickHandler);
                            piece.style.cursor = 'pointer';
                        });
                        document.querySelectorAll('.cell').forEach(cell => {
                            cell.addEventListener('click', cellClickHandler);
                        });
						
                    }
                });
					//–•–æ–¥ –∂–µ–ª—Ç–æ–≥–æ –Ω–∞ 1 –∏ 2
					clearHighlight();
					updateGameMessage('–¢–µ–ø–µ—Ä—å —Ö–æ–¥ –∂–µ–ª—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞.');
					await delay(1000);

					currentPlayer = 2;
					updatePlayerDiceStates();

					await animateDiceRoll(2, [6, 5]);
					await delay(500);
					await selectAndMovePiece('p2_4', 'I5');
					await selectAndMovePiece('p2_4', 'L7');
					
					await delay(1000);

				// –ü–µ—Ä–µ–¥–∞–µ–º —Ö–æ–¥ –∫—Ä–∞—Å–Ω–æ–º—É –∏–≥—Ä–æ–∫—É
                currentPlayer = 1;
                updatePlayerDiceStates();

				// –®–∞–≥ 11: –ó–∞—Ö–æ–¥ –≤ –¥–æ–º
                await showStep({
                    stepNumber: 11,
                    totalSteps: 12,
                    message: '–í–∞—à–∞ –æ—á–µ—Ä–µ–¥—å, –±—Ä–æ—Å–∞–π—Ç–µ –∫—É–±–∏–∫–∏!',
                    buttonText: '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å',
                    highlight: null,
                    onShow: () => {
                        const btn = document.getElementById('random-move-btn');
                        btn.disabled = true;
                        btn.classList.remove('tutorial-button-active');

                        // –ü–æ–ª—É—á–∞–µ–º –∫—É–±–∏–∫–∏ –≤–Ω—É—Ç—Ä–∏ onShow
                        const dice1 = document.getElementById('player-dice-1-1');
                        const dice2 = document.getElementById('player-dice-1-2');

                        const diceClickHandler = async () => {
                            // –ê–Ω–∏–º–∞—Ü–∏—è –±—Ä–æ—Å–∫–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º 6:4
                            await animateDiceRoll(1, [6, 4]);

                            // –û—á–∏—Å—Ç–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–ª–∏–∫)
                            dice1.removeEventListener('click', diceClickHandler);
                            dice2.removeEventListener('click', diceClickHandler);

							updateGameMessage('–í—ã–ø–∞–ª–æ 6 –∏ 4. –û–¥–Ω–∞ —à–µ—Å—Ç–µ—Ä–∫–∞ —Ç—Ä–∞—Ç–∏—Ç—Å—è –Ω–∞ –≤—ã—Ö–æ–¥ –∏–∑ —Ç—é—Ä—å–º—ã, –∞ –Ω–∞ –≤—Ç–æ—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—ã –∑–∞—Ö–æ–¥–∏—Ç–µ –≤ –¥–æ–º.');

                            // –ù–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ - –∂–¥–µ–º –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                            await delay(500);
                        };

                        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
                        dice1.addEventListener('click', diceClickHandler);
                        dice2.addEventListener('click', diceClickHandler);
                        dice1.classList.add('active');
                        dice2.classList.add('active');


                        const redPiecesInStart = document.querySelectorAll('.piece.player1');

                        const pieceClickHandler = (event) => {
                            const piece = event.currentTarget;
                            if (selectedPiece === piece) {
                                updateSelectedPiece(null, true); // true = –æ—á–∏—Å—Ç–∏—Ç—å —Ö–∏–Ω—Ç—ã
                            } else {
                                // –í—ã–¥–µ–ª—è–µ–º —Ñ–∏—à–∫—É –±–µ–∑ –ø–æ–∫–∞–∑–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ö–∏–Ω—Ç–æ–≤
                                if (selectedPiece) {
                                    selectedPiece.classList.remove('selected');
                                }
                                selectedPiece = piece;
                                piece.classList.add('selected');

                                // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Ö–∏–Ω—Ç—ã
                                clearMoveHints();

                                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ö–∏–Ω—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ–∏—à–∫–∏ –Ω–∞ H3
                                const pieceCoord = getCurrentPosition(piece);
                                if (pieceCoord === 'F2') {
                                    // –•–∏–Ω—Ç –Ω–∞ H3
                                    const cellH3 = document.querySelector('[data-coord="H3"]');
                                    if (cellH3) {
                                        const hint1 = document.createElement('div');
                                        hint1.className = 'move-hint teleport-hint';
                                        hint1.textContent = '4';
                                        cellH3.appendChild(hint1);
                                        cellH3.classList.add('possible-move');
                                    }

                                    
                                }
                                
                            }
                        };

                        const cellClickHandler = async (event) => {
                            const cell = event.currentTarget;
                            const coord = cell.dataset.coord;

                            if (selectedPiece && cell.classList.contains('possible-move')) {
                                const pieceCoord = getCurrentPosition(selectedPiece);

                                // –ö–ª–∏–∫ –Ω–∞ H3
                                if (coord === 'H3' && pieceCoord === 'F2') {
                                    // –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ñ–∏—à–∫—É –Ω–∞ H3 –Ω–∞–ø—Ä—è–º—É—é (–±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏)
                                    movePiece(selectedPiece, 'H3');

                                    // –û—Ç–º–µ—á–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—É–±–∏–∫–∞ 3
                                    diceUsed[0] = true;
									diceUsed[1] = true;

                                    // –û—á–∏—â–∞–µ–º —Ö–∏–Ω—Ç—ã
                                    clearMoveHints();

                                    // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å —Ñ–∏—à–∫–∏
                                    updateSelectedPiece(null, true);

                                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ö–æ–¥–∞
                                    updateGameMessage('–¢–µ–ø–µ—Ä—å —ç—Ç–∞ —Ñ–∏—à–∫–∞ –≤ —Ç—é—Ä—å–º–µ, –±—É–¥–µ–º –∂–¥–∞—Ç—å 6 —Ö–æ—Ç—è –±—ã –Ω–∞ –æ–¥–Ω–æ–º –∏–∑ –∫—É–±–∏–∫–æ–≤ –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ç—é—Ä—å–º—ã.');

                                    // –û—á–∏—â–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
                                    redPiecesInStart.forEach(p => {
                                        p.removeEventListener('click', pieceClickHandler);
                                        p.style.cursor = '';
                                    });
                                    document.querySelectorAll('.cell').forEach(c => {
                                        c.removeEventListener('click', cellClickHandler);
                                    });

                                    nextStep (btn);

                                }                             
                                
                            }
                        };

                        redPiecesInStart.forEach(piece => {
                            piece.addEventListener('click', pieceClickHandler);
                            piece.style.cursor = 'pointer';
                        });
                        document.querySelectorAll('.cell').forEach(cell => {
                            cell.addEventListener('click', cellClickHandler);
                        });
						
                    }
                });
					//–•–æ–¥ –∂–µ–ª—Ç–æ–≥–æ –Ω–∞ 3 –∏ 2
					clearHighlight();
					updateGameMessage('–¢–µ–ø–µ—Ä—å —Ö–æ–¥ –∂–µ–ª—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞.');
					await delay(1000);

					currentPlayer = 2;
					updatePlayerDiceStates();

					await animateDiceRoll(2, [6, 5]);
					await delay(500);
					await selectAndMovePiece('p2_2', 'G11');					
					
					await delay(1000);

				// –ü–µ—Ä–µ–¥–∞–µ–º —Ö–æ–¥ –∫—Ä–∞—Å–Ω–æ–º—É –∏–≥—Ä–æ–∫—É
                currentPlayer = 1;
                updatePlayerDiceStates(); 

				// –ù–æ–≤—ã–π —à–∞–≥ 11: –ü—Ä–æ–ø—É—Å–∫ —Ö–æ–¥–∞
                await showStep({
                    stepNumber: 11,
                    totalSteps: 12,
                    message: '–ñ–µ–ª—Ç—ã–π –∏–≥—Ä–æ–∫ —Å—Ö–æ–¥–∏–ª. –í–∞—à–∞ –æ—á–µ—Ä–µ–¥—å, –±—Ä–æ—Å–∞–π—Ç–µ –∫—É–±–∏–∫–∏!',
                    buttonText: '–ü–æ–Ω—è—Ç–Ω–æ',
                    highlight: null,                    
                    onShow: () => {
                        const btn = document.getElementById('random-move-btn');
                        btn.disabled = true;
                        btn.classList.remove('tutorial-button-active');

                        // –ü–æ–ª—É—á–∞–µ–º –∫—É–±–∏–∫–∏ –≤–Ω—É—Ç—Ä–∏ onShow
                        const dice1 = document.getElementById('player-dice-1-1');
                        const dice2 = document.getElementById('player-dice-1-2');

                        const diceClickHandler = async () => {
                            // –ê–Ω–∏–º–∞—Ü–∏—è –±—Ä–æ—Å–∫–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º 2:5
                            await animateDiceRoll(1, [2, 5]);

                            // –û—á–∏—Å—Ç–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–ª–∏–∫)
                            dice1.removeEventListener('click', diceClickHandler);
                            dice2.removeEventListener('click', diceClickHandler);
							
							updateGameMessage('–í—ã–ø–∞–ª–æ 2 –∏ 5. <u>–ü–æ –ø—Ä–∞–≤–∏–ª—É –±–æ–ª—å—à–µ–≥–æ —Ö–æ–¥–∞:</u> –µ—Å–ª–∏ –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–∞ –∫—É–±–∏–∫–∞, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª—å—à–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ. –£ –≤–∞—Å –æ—Å—Ç–∞–ª–æ—Å—å 2 —à–∞–≥–∞ –≤ –¥–æ–º–µ –∏ –±–æ–ª—å—à–µ –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤, –∞ –≤—ã–ø–∞–ª–æ 2 –∏ 5 - –±–æ–ª—å—à–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (5) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–ª—å–∑—è, –ø–æ—ç—Ç–æ–º—É —Ö–æ–¥ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è.');
							
							highlightZone (['[id^="player-dice-1-"]']);					

							// –ü—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –∂–¥–µ–º –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏
							await new Promise((resolve) => {
								const btn = document.getElementById('random-move-btn');
								btn.disabled = false;
								btn.classList.add('tutorial-button-active');

								const clickHandler = () => {
									btn.disabled = true;
									btn.classList.remove('tutorial-button-active');
									btn.removeEventListener('click', clickHandler);
									resolve();
								};

								btn.addEventListener('click', clickHandler);
							});
							await delay(500);
							clearHighlight ();
							await delay(500);
                            

                            nextStep (btn);							
                        };

                        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
                        dice1.addEventListener('click', diceClickHandler);
                        dice2.addEventListener('click', diceClickHandler);
                        dice1.classList.add('active');
                        dice2.classList.add('active');
																		
                    }
                });
				currentPlayer = 2;
				updatePlayerDiceStates();

				await animateDiceRoll(2, [6, 6]);
				await delay(500);
				updateGameMessage('–£ –∂–µ–ª—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –≤—ã–ø–∞–ª <u> –¥—É–±–ª—å 6:6 </u>, –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Ö–æ–¥–∞ –æ–Ω –ø–æ–≤—Ç–æ—Ä–Ω–æ –±—Ä–æ—Å–∞–µ—Ç –∫—É–±–∏–∫–∏!');
				await selectAndMovePiece('p2_4', 'N9');
				await selectAndMovePiece('p2_4', 'I10');
					
				await delay(1000);
				//–ü–æ–≤—Ç–æ—Ä–Ω—ã–π —Ö–æ–¥ –∂–µ–ª—Ç–æ–≥–æ –ø–æ—Å–ª–µ –¥—É–±–ª—è
				currentPlayer = 2;
				updatePlayerDiceStates();

				await animateDiceRoll(2, [2, 2]);
				await delay(500);
				await selectAndMovePiece('p2_2', 'G9');
				await selectAndMovePiece('p2_4', 'I12');
					// –ü–µ—Ä–µ–¥–∞–µ–º —Ö–æ–¥ –∫—Ä–∞—Å–Ω–æ–º—É –∏–≥—Ä–æ–∫—É
                currentPlayer = 1;
                updatePlayerDiceStates();
				

                await showStep({
                    stepNumber: 12,
                    totalSteps: 12,
                    message: '–í–∞—à–∞ –æ—á–µ—Ä–µ–¥—å, –±—Ä–æ—Å–∞–π—Ç–µ –∫—É–±–∏–∫–∏.',
                    buttonText: '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å',
                    highlight: null,
                    onShow: () => {
                        const btn = document.getElementById('random-move-btn');
                        btn.disabled = true;
                        btn.classList.remove('tutorial-button-active');

                        const diceClickHandler = async () => {
                            await animateDiceRoll(1, [2, 1]);

                            dice1.removeEventListener('click', diceClickHandler);
                            dice2.removeEventListener('click', diceClickHandler);                           
							nextStep (btn);
                        };

                        dice1.addEventListener('click', diceClickHandler);
                        dice2.addEventListener('click', diceClickHandler);
                        dice1.classList.add('active');
                        dice2.classList.add('active');
                    }
                });

                // –®–∞–≥ 3: –°—Ç–∞—Ä—Ç–æ–≤–∞—è –∑–æ–Ω–∞ - –∫—Ä–∞—Å–Ω—ã–π –∏–≥—Ä–æ–∫ –¥–µ–ª–∞–µ—Ç —Ö–æ–¥
                await showStep({
                    stepNumber: 12,
                    totalSteps: 12,
                    message: '–ó–∞–≤–µ–¥–∏—Ç–µ —Ñ–∏—à–∫—É –¥–æ –∫–æ–Ω—Ü–∞ –≤ –¥–æ–º –∏ –Ω–∞—á–Ω–∏—Ç–µ –¥—Ä—É–≥–æ–π —Ñ–∏—à–∫–æ–π –ø—É—Ç—å –≤ –¥–æ–º.',
                    buttonText: '–î–∞–ª–µ–µ',
                    highlight: null,
                    onShow: () => {
                        const btn = document.getElementById('random-move-btn');
                        btn.disabled = true;
                        btn.classList.remove('tutorial-button-active');

                        const redPiecesInStart = document.querySelectorAll('.piece.player1');

                        const pieceClickHandler = (event) => {
                            const piece = event.currentTarget;
                            if (selectedPiece === piece) {
                                updateSelectedPiece(null);
                            } else {
                                updateSelectedPiece(piece);
                            }
                        };

                        const cellClickHandler = (event) => {
                            const cell = event.currentTarget;
                            const coord = cell.dataset.coord;
                            if (selectedPiece && cell.classList.contains('possible-move')) {
                                performMove(selectedPiece, coord);

                                const allDiceUsed = diceUsed[0] && diceUsed[1];
                                if (allDiceUsed) {
                                    redPiecesInStart.forEach(p => {
                                        p.removeEventListener('click', pieceClickHandler);
                                        p.style.cursor = '';
                                    });
                                    document.querySelectorAll('.cell').forEach(c => {
                                        c.removeEventListener('click', cellClickHandler);
                                    });

                                    nextStep (btn);
                                }
                            }
                        };

                        redPiecesInStart.forEach(piece => {
                            piece.addEventListener('click', pieceClickHandler);
                            piece.style.cursor = 'pointer';
                        });
                        document.querySelectorAll('.cell').forEach(cell => {
                            cell.addEventListener('click', cellClickHandler);
                        });
                    }
                });
                

                // –û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
                finishTutorial();

            } catch (error) {
                updateGameMessage('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –≤ –æ–±—É—á–µ–Ω–∏–∏. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
            }
        }

        // ================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò –ó–ê–í–ï–†–®–ï–ù–ò–ï –û–ë–£–ß–ï–ù–ò–Ø
        // ================================

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—É—á–µ–Ω–∏—è
        function initTutorial() {
            isTutorialActive = true;
            runTutorial();
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—É—á–µ–Ω–∏—è
        function finishTutorial() {
            isTutorialActive = false;
            clearHighlight();
            updateGameMessage('–í–∞—à–∞ –≤—Ç–æ—Ä–∞—è —Ñ–∏—à–∫–∞ –∑–∞—à–ª–∞ –≤ –¥–æ–º! üéâ <u>–û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!</u> –í—ã –æ—Å–≤–æ–∏–ª–∏ –≤—Å–µ –º–µ—Ö–∞–Ω–∏–∫–∏ –∏–≥—Ä—ã: ‚úì –ë–∞–∑–æ–≤—ã–µ —Ö–æ–¥—ã ‚úì –¢–µ–ª–µ–ø–æ—Ä—Ç—ã ‚úì –°—ä–µ–¥–µ–Ω–∏–µ —Ñ–∏—à–µ–∫ ‚úì –•—Ä–∞–º—ã –∏ —Ç—é—Ä—å–º—ã ‚úì –ó–∞—Ö–æ–¥ –≤ –¥–æ–º ‚úì –ü—Ä–∞–≤–∏–ª–æ –±–æ–ª—å—à–µ–≥–æ —Ö–æ–¥–∞. /n –£–¥–∞—á–∏ –≤ –∏–≥—Ä–µ!');

            const counter = document.getElementById('tutorial-step-counter');
            counter.innerHTML = '<span class="step-number">‚úì –û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ</span>';

            const btn = document.getElementById('random-move-btn');
            btn.disabled = false;
			btn.textContent = '–ù–∞—á–∞—Ç—å –∏–≥—Ä—É';
            btn.classList.add('tutorial-button-active');
        }

    </script>
</body>
</html>